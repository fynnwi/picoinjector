<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="picoinjector">
<title>SU-8 3035 Spincurve Analysis • picoinjector</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SU-8 3035 Spincurve Analysis">
<meta property="og:description" content="picoinjector">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">picoinjector</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/droplet_volumes.html">Volume Estimates</a>
    <a class="dropdown-item" href="../articles/electrical_engineering.html">Electrical Engineering</a>
    <a class="dropdown-item" href="../articles/hydraulic_resistance.html">Hydraulic resistance</a>
    <a class="dropdown-item" href="../articles/spincurves.html">SU-8 3035 Spincurve Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>SU-8 3035 Spincurve Analysis</h1>
            
      
      
      <div class="d-none name"><code>spincurves.Rmd</code></div>
    </div>

    
    
<!-- To do: -->
<!-- - change units to um and mm -->
<div class="section level2">
<h2 id="introduction">introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>For my microfluidic chips, channel heights in the range of 20-30 um
are desired. To obtain these heights during the photolithography
process, a photoresist with suitable viscosity is required. <img src="images/001_su8_3000_spincurves.png" style="width:50.0%" alt="SU-8 3000 thickness"></p>
<p>These are the spin curves for the SU-8 3000 series <span class="citation">(<span>“<span>SU</span>-8 3000 for Microstructure
Fabrication <span></span> Kayaku Advanced Materials. Kayaku Advanced
Materials, Inc.”</span> n.d.)</span>. It seems like SU-8 3035 can yield
thicknesses in the desired range (extrapolating for higher RPMs, and
from the experience that at 6000 RPM 30 um thickness can be achieved
with SU-8 3050). Therefore, 115.2 g SU-8 3050 was mixed with 1.42 g of
thinner solution, in order to obtain a custom dilution that mimics the
behaviour of SU-8 3035. In the following, SU-8 3035 refers to this
custom dilution.</p>
<p>After preparation of SU-8 3035, a spin curve analysis was conducted
to characterize the relation between spin speed and film thickness of
the custom photoresist. To that end, a cross pattern (see image) was
exposed on cleaned and re-used silicon wafers, after spin-coating SU-8
3035 at 3000, 4000, and 5000 RPM, respectively. For each of these RPM,
three chips were prepared: two chips using a spin duration of 30s (to
have duplicate measurements), and one chip using a spin duration of 60
s. Therefore, in total, nine wafers were prepared.</p>
<p><img src="images/004_spincurve_cross_pattern_traces.png" style="width:50.0%" alt="Spincurve cross pattern"><img src="images/003_spincurve_cross_pattern_zoom.png" style="width:50.0%" alt="Spincurve cross pattern"></p>
<p>After photolithography, the resulting height profiles were measured
using a Dektak profilometer. Unfortunately, when measuring over long
distances with this machine, measurements are drifting away from the
reference level quite significantly, which necessitates a correction
before data evalutation. Therefore, the cross structure exposed on the
wafer includes repeated gaps in order to pick up the zero-level along
the entire wafer.</p>
<p>These are the wafer ids corresponding to a certain combination of
spin time and spin speed:</p>
<table class="table">
<colgroup>
<col width="23%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th>spin time / RPM</th>
<th>3000</th>
<th>4000</th>
<th>5000</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>30 s</td>
<td>job9945, job9946</td>
<td>job9947, job9948</td>
<td>job9949, job9950</td>
</tr>
<tr class="even">
<td>60 s</td>
<td>job10055</td>
<td>job10053</td>
<td>job10054</td>
</tr>
</tbody>
</table>
<p>For each wafer, four traces were measured: top-to-bottom,
left-to-right, bottom-to-top, and right-to-left (see figure). This
results in duplicate measurements for all the structures.</p>
<p>In this vignette, the post-processing and drift correction of the
Dektak data will be carried out. This includes:</p>
<ul>
<li>reading in CSV files,</li>
<li>recognition of the reference level segments,</li>
<li>drift correction,</li>
<li>averaging of duplicate measurements,</li>
<li>interpolation of height profiles between the gaps in the
structure.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">picoinjector</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="co"># library(tidyr)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-loading">data loading<a class="anchor" aria-label="anchor" href="#data-loading"></a>
</h2>
<p>Get file names:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/spincurve_csv/"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">files</span><span class="op">)</span>
<span class="co">#&gt; [1] "data/spincurve_csv//00_job9945_eastwest.csv"  </span>
<span class="co">#&gt; [2] "data/spincurve_csv//01_job9945_northsouth.csv"</span>
<span class="co">#&gt; [3] "data/spincurve_csv//01_job9945_westeast.csv"  </span>
<span class="co">#&gt; [4] "data/spincurve_csv//02_job9946_southnorth.csv"</span>
<span class="co">#&gt; [5] "data/spincurve_csv//03_job9945_southnorth.csv"</span>
<span class="co">#&gt; [6] "data/spincurve_csv//03_job9950_northsouth.csv"</span></code></pre></div>
<p>Read in all the csv files and concatenate them into a single tibble
dataframe:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="va">files</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">f</span>, skip <span class="op">=</span> <span class="fl">19</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span>, col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"position"</span>, <span class="st">"height"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">position</span>, <span class="va">height</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span> <span class="co"># add the wafer id</span>
  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">d</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">results</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,815,001 × 3</span></span>
<span class="co">#&gt;    position height id                     </span>
<span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      0     1.85 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      0.5   1.22 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      1     0.59 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      1.5   0    00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      2    -<span style="color: #BB0000;">0.51</span> 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      2.5  -<span style="color: #BB0000;">0.95</span> 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      3    -<span style="color: #BB0000;">1.32</span> 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      3.5  -<span style="color: #BB0000;">1.63</span> 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      4    -<span style="color: #BB0000;">1.88</span> 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>      4.5  -<span style="color: #BB0000;">2.08</span> 00_job9945_eastwest.csv</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 2,814,991 more rows</span></span>
<span class="co">#&gt; <span style="color: #949494;"># ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>Add information about spin speed and duration:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># table relating wafer id with RPM</span>
<span class="va">rpm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>job9945 <span class="op">=</span> <span class="fl">3000</span>, job9946 <span class="op">=</span> <span class="fl">3000</span>, job9947 <span class="op">=</span> <span class="fl">4000</span>, job9948 <span class="op">=</span> <span class="fl">4000</span>,
         job9949 <span class="op">=</span> <span class="fl">5000</span>, job9950 <span class="op">=</span> <span class="fl">5000</span>, job10053 <span class="op">=</span> <span class="fl">4000</span>, job10054 <span class="op">=</span> <span class="fl">5000</span>, job10055 <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span>

<span class="co"># table relating wafer id with seconds at max RPM</span>
<span class="va">spinTime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>job9945 <span class="op">=</span> <span class="fl">30</span>, job9946 <span class="op">=</span> <span class="fl">30</span>, job9947 <span class="op">=</span> <span class="fl">30</span>, job9948 <span class="op">=</span> <span class="fl">30</span>,
         job9949 <span class="op">=</span> <span class="fl">30</span>, job9950 <span class="op">=</span> <span class="fl">30</span>, job10053 <span class="op">=</span> <span class="fl">60</span>, job10054 <span class="op">=</span> <span class="fl">60</span>, job10055 <span class="op">=</span> <span class="fl">60</span><span class="op">)</span>

<span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>wafer <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"job\\d+"</span><span class="op">)</span>,
         direction <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">id</span>, <span class="st">"[a-z]+\\."</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
           <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="st">"\\."</span><span class="op">)</span>,
         orientation <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">direction</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eastwest"</span>, <span class="st">"westeast"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"horizontal"</span>,
                                 <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"vertical"</span><span class="op">)</span>,
         rpm <span class="op">=</span> <span class="va">rpm</span><span class="op">[</span><span class="va">wafer</span><span class="op">]</span>,
         spintime <span class="op">=</span> <span class="va">spinTime</span><span class="op">[</span><span class="va">wafer</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># order rows by wafer, direction and position</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rpm</span>, <span class="va">spintime</span>, <span class="va">direction</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">rpm</span>, <span class="va">spintime</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">results</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,815,001 × 8</span></span>
<span class="co">#&gt;    position height id                      wafer   direc…¹ orien…²   rpm spint…³</span>
<span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>      0     1.85 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>      0.5   1.22 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>      1     0.59 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>      1.5   0    00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>      2    -<span style="color: #BB0000;">0.51</span> 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>      2.5  -<span style="color: #BB0000;">0.95</span> 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>      3    -<span style="color: #BB0000;">1.32</span> 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>      3.5  -<span style="color: #BB0000;">1.63</span> 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      4    -<span style="color: #BB0000;">1.88</span> 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>      4.5  -<span style="color: #BB0000;">2.08</span> 00_job9945_eastwest.csv job9945 eastwe… horizo…  <span style="text-decoration: underline;">3</span>000      30</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 2,814,991 more rows, and abbreviated variable names ¹​direction,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ²​orientation, ³​spintime</span></span>
<span class="co">#&gt; <span style="color: #949494;"># ℹ Use `print(n = ...)` to see more rows</span></span></code></pre></div>
<p>The raw data looks like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">profile</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># filter for single trace</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"00_job9945_eastwest.csv"</span><span class="op">)</span>

<span class="fu"><a href="../reference/plot_heightprofile.html">plot_heightprofile</a></span><span class="op">(</span><span class="va">profile</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="baseline-correction">baseline correction<a class="anchor" aria-label="anchor" href="#baseline-correction"></a>
</h2>
<p>Now I use the geometrical information of my design to determine peaks
and valleys in the trace. First, I find the positions (x coordinate) of
the leftmost and rightmost structure using the slope of the graph, and
then I rescale everything so that it spans the known width of 40.5 mm
that was written on the wafer. The rescaling is necessary in case the
trace was not perfectly aligned with the structure, i.e. slightly
diagonal and therefore a little bit longer.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">profile</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">position</span> <span class="op">&lt;</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># zoom at left-most peak</span>
  <span class="fu"><a href="../reference/plot_heightprofile.html">plot_heightprofile</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>To find the x coordinate were the first structure begins, I calculate
the first derivative of the height profile (lagged differences) in order
to identify regions with large slope. The first derivative of above
graph then looks like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># lagged differences parameters</span>
<span class="va">lag</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">dif</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">offset</span> <span class="op">&lt;-</span> <span class="va">dif</span> <span class="op">*</span> <span class="va">lag</span>

<span class="co"># calculate derivative</span>
<span class="va">derivative</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  <span class="st">"d_height"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">profile</span><span class="op">$</span><span class="va">height</span>, lag <span class="op">=</span> <span class="va">lag</span>, differences <span class="op">=</span> <span class="va">dif</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">profile</span><span class="op">$</span><span class="va">position</span>, lag <span class="op">=</span> <span class="va">lag</span>, differences <span class="op">=</span> <span class="va">dif</span><span class="op">)</span>,
  <span class="co"># adjust dimension of x axis (lagging difference removes the first l elements):</span>
  <span class="st">"position"</span> <span class="op">=</span> <span class="va">profile</span><span class="op">$</span><span class="va">position</span><span class="op">[</span><span class="op">(</span><span class="va">offset</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">profile</span><span class="op">$</span><span class="va">position</span><span class="op">)</span><span class="op">]</span>
<span class="op">)</span>

<span class="va">derivative</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">position</span> <span class="op">&lt;</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># zoom to first structure</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span>, y <span class="op">=</span> <span class="va">d_height</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Derivative of height profile"</span>,
       subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Lag ="</span>, <span class="va">lag</span>, <span class="st">", difference order ="</span>, <span class="va">dif</span><span class="op">)</span>,
       x <span class="op">=</span> <span class="st">"Lateral position [um]"</span>,
       y <span class="op">=</span> <span class="st">"Lagged difference magnitude"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The <code>lag</code> parameter defines the sliding window size that
should be used for difference calculation and can be used to smooth the
resulting derivative plot. For the remainder of this analysis, I will
use <code>lag = 10</code>.</p>
<p>This function finds the index of the first edge of the height
profile, which should correspond to the edge of the first structure on
the wafer (left-to-right). The x coordinate where the derivative first
exceeds a give threshold <code>minSlope</code> is identified as an edge.
For this analysis I am using <code>minSlope = 500</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_index_first_peak</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">values</span>, <span class="va">minSlope</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># find the first maximum</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="kw">while</span> <span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">values</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&gt;</span> <span class="va">minSlope</span><span class="op">)</span> <span class="op">{</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span><span class="op">+</span><span class="fl">1</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="fu">get_index_first_peak</span><span class="op">(</span><span class="va">derivative</span><span class="op">$</span><span class="va">d_height</span>, <span class="fl">500</span><span class="op">)</span>
<span class="co">#&gt; [1] 816</span></code></pre></div>
<p>Now above defined function can be used to determine the start and end
coordinate of a profile. Using this information, the total length of a
profile can be rescaled to cover 40.5 mm which is known from the initial
AutoCAD design. This function detects the beginning and end of the
height profile and then rescales the corresponding lateral position</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rescale_profile</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">profile</span>, <span class="va">lag</span>, <span class="va">minSlope</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># calculate derivative of height w.r.t. position</span>
  <span class="va">dHeight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">profile</span><span class="op">[[</span><span class="st">"height"</span><span class="op">]</span><span class="op">]</span>, lag <span class="op">=</span> <span class="va">lag</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">profile</span><span class="op">[[</span><span class="st">"position"</span><span class="op">]</span><span class="op">]</span>, lag <span class="op">=</span> <span class="va">lag</span><span class="op">)</span>
  <span class="co"># get index of first peak</span>
  <span class="va">first</span> <span class="op">&lt;-</span> <span class="fu">get_index_first_peak</span><span class="op">(</span><span class="va">dHeight</span>, <span class="va">minSlope</span><span class="op">)</span>
  <span class="co"># get index of last peak</span>
  <span class="va">last</span> <span class="op">&lt;-</span> <span class="fu">get_index_first_peak</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">dHeight</span><span class="op">)</span><span class="op">*</span> <span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="va">minSlope</span><span class="op">)</span>
  
  <span class="co"># convert indices into corresponding position value</span>
  <span class="va">posFirst</span> <span class="op">&lt;-</span> <span class="va">profile</span><span class="op">[[</span><span class="st">"position"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">first</span> <span class="op">+</span> <span class="va">lag</span><span class="op">]</span>
  <span class="va">posLast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">profile</span><span class="op">[[</span><span class="st">"position"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">last</span><span class="op">]</span>
  
  <span class="co"># rescale everything: distance between first and last position should be exactly 45mm</span>
  <span class="co"># discard data outside of the interval</span>
  <span class="va">profile</span><span class="op">[</span><span class="op">(</span><span class="va">first</span> <span class="op">+</span> <span class="va">lag</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">profile</span><span class="op">)</span><span class="op">-</span><span class="va">last</span><span class="op">)</span>, <span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40500</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>A rescaled profile then looks like this. Note how the beginning and
end are truncated, compared to the plot of the same trace shown
above.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">profileRescaled</span> <span class="op">&lt;-</span> <span class="va">profile</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">rescale_profile</span><span class="op">(</span>lag <span class="op">=</span> <span class="fl">10</span>, minSlope <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>

<span class="fu"><a href="../reference/plot_heightprofile.html">plot_heightprofile</a></span><span class="op">(</span><span class="va">profileRescaled</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Next, the geometrical information known from the AutoCAD design can
be used to identify the peaks and valleys present in the design. At the
valleys, the height profile is then sampled at discrete points in order
to capture the baseline shift. These discrete baseline points will later
be used to fit a continuous baseline curve.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_baseline_points</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">profile</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># sample points to capture the baseline</span>
  <span class="va">samplePoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">750</span>, <span class="fl">40500</span>, by <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
  <span class="co"># exclude center region (has no gap)</span>
  <span class="va">samplePoints</span> <span class="op">&lt;-</span> <span class="va">samplePoints</span><span class="op">[</span><span class="va">samplePoints</span> <span class="op">&lt;</span> <span class="fl">19000</span> <span class="op">|</span> <span class="va">samplePoints</span> <span class="op">&gt;</span> <span class="fl">21500</span><span class="op">]</span>
  <span class="va">xIndices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">samplePoints</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>, <span class="va">profile</span><span class="op">[[</span><span class="st">"position"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  
  <span class="co"># return baseline points</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"position"</span> <span class="op">=</span> <span class="va">profile</span><span class="op">[[</span><span class="st">"position"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">xIndices</span><span class="op">]</span>,
         <span class="st">"height"</span> <span class="op">=</span> <span class="va">profile</span><span class="op">[[</span><span class="st">"height"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">xIndices</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The sampled baseline data points look like this:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baselinePoints</span> <span class="op">&lt;-</span> <span class="va">profileRescaled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">get_baseline_points</span><span class="op">(</span><span class="op">)</span>

<span class="va">baselinePoints</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 38 × 2</span></span>
<span class="co">#&gt;    position  height</span>
<span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     750.  126.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    <span style="text-decoration: underline;">1</span>750.  206.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    <span style="text-decoration: underline;">2</span>750.  246.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    <span style="text-decoration: underline;">3</span>750.  236.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    <span style="text-decoration: underline;">4</span>750.  174.  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    <span style="text-decoration: underline;">5</span>750.   92.9 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    <span style="text-decoration: underline;">6</span>750.   -<span style="color: #BB0000;">2.16</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    <span style="text-decoration: underline;">7</span>750. -<span style="color: #BB0000;">151.</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    <span style="text-decoration: underline;">8</span>750. -<span style="color: #BB0000;">310.</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    <span style="text-decoration: underline;">9</span>750. -<span style="color: #BB0000;">436.</span>  </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 28 more rows</span></span>
<span class="co">#&gt; <span style="color: #949494;"># ℹ Use `print(n = ...)` to see more rows</span></span>

<span class="va">profileRescaled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/plot_heightprofile.html">plot_heightprofile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">baselinePoints</span>, shape <span class="op">=</span> <span class="fl">23</span>, color <span class="op">=</span> <span class="st">"firebrick1"</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Use LOESS regression to fit curve to the baseline data points:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baseline_regression</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">profile</span>, <span class="va">baselinePoints</span>, <span class="va">loessSpan</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># LOESS regression to fit a function to the baseline data points</span>
  <span class="va">loessModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/loess.html" class="external-link">loess</a></span><span class="op">(</span><span class="va">height</span> <span class="op">~</span> <span class="va">position</span>, data <span class="op">=</span> <span class="va">baselinePoints</span>, span <span class="op">=</span> <span class="va">loessSpan</span><span class="op">)</span>
  
  <span class="co"># extrapolate</span>
  <span class="va">profile</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"baseline"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">loessModel</span>, <span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Regression of the baseline points looks like this:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">profileRescaled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">baseline_regression</span><span class="op">(</span><span class="va">baselinePoints</span>, loessSpan <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/plot_heightprofile.html">plot_heightprofile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">baseline</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"firebrick2"</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 3004 row(s) containing missing values (geom_path).</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Note: loess regression doesn’t allow extrapolation, removes leftmost
and rightmost data points.</p>
<p>The regression line can the be subtracted from the height data in
order to level all the valleys to zero.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subtract_baseline</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">profile</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">profile</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>height <span class="op">=</span> <span class="va">height</span> <span class="op">-</span> <span class="va">baseline</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">baseline</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">profileRescaled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">baseline_regression</span><span class="op">(</span><span class="va">baselinePoints</span>, loessSpan <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">subtract_baseline</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/plot_heightprofile.html">plot_heightprofile</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>This function combines all the steps:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baseline_correction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">profile</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># lag and minSlope are hardcoded in here!</span>
  <span class="va">rescaled</span> <span class="op">&lt;-</span> <span class="va">profile</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">rescale_profile</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">500</span><span class="op">)</span>
  
  <span class="va">baselinePoints</span> <span class="op">&lt;-</span> <span class="va">rescaled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">get_baseline_points</span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">rescaled</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">baseline_regression</span><span class="op">(</span><span class="va">baselinePoints</span>, <span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">subtract_baseline</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Iterate over all the traces and correct for baseline shift:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resultsCorrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">traceId</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">corrected</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">traceId</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">baseline_correction</span><span class="op">(</span><span class="op">)</span>
  <span class="va">resultsCorrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">resultsCorrected</span>, <span class="va">corrected</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>This function can be used to plot the baseline-corrected profiles for
every wafer:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_heightprofile_bywafer.html">plot_heightprofile_bywafer</a></span><span class="op">(</span><span class="va">resultsCorrected</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-18-1.png" width="960"></p>
<p>As can be seen in this overview plot, the baseline correction method
seems to work for all the profiles.</p>
</div>
<div class="section level2">
<h2 id="post-processing">post-processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h2>
<p>The next step in the analysis is to summarize the duplicate
measurements that exist for every structure, and interpolate the height
profile across the gaps, in order to obtain a comprehensive plot that
describes the spin coating thickness as a function of the radial
distance from the wafer center, as well as RPM and spin time.</p>
<p>Function that removes the baseline segments of the data using the
known locations of valleys in the structure, and interpolating those
values from the surrounding data:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Geometrically, a valley is 500 um wide. Set to a larger value than that to filter out overshoots in the signal at the edges</span>
<span class="va">interpolate_valleys</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">profile</span>, <span class="va">width</span> <span class="op">=</span> <span class="fl">650</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co">## 1. remove gap data</span>
  <span class="co"># the baseline centers are supposed to be located right in the middle of the valleys</span>
  <span class="va">baselineCenters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">250</span>, <span class="fl">42000</span>, by <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
  <span class="co"># exclude middle region</span>
  <span class="co"># baselineCenters &lt;- baselineCenters[baselineCenters &lt; 19000 | baselineCenters &gt; 21500]</span>
  <span class="va">baselinePositions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">baselineCenters</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">width</span>, <span class="va">x</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">)</span>
  
  <span class="va">positionsRounded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">profile</span><span class="op">[[</span><span class="st">"position"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="va">positionsRounded</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">baselinePositions</span>
  
  <span class="va">positions</span> <span class="op">&lt;-</span> <span class="va">profile</span><span class="op">$</span><span class="va">position</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>
  <span class="va">height</span> <span class="op">&lt;-</span> <span class="va">profile</span><span class="op">$</span><span class="va">height</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>
  
  <span class="co">## 2. interpolate between gaps</span>
  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">positions</span>, <span class="va">height</span>, <span class="va">profile</span><span class="op">$</span><span class="va">position</span><span class="op">)</span>
  
  <span class="va">profile</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>height <span class="op">=</span> <span class="va">a</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The resulting height profile does not contain gaps anymore:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resultsCorrected</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"00_job9945_eastwest.csv"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">interpolate_valleys</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/plot_heightprofile.html">plot_heightprofile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>Do this for all traces and show them in a single plot:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resultsInterpolated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">traceId</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">resultsCorrected</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">resultsCorrected</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="va">traceId</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu">interpolate_valleys</span><span class="op">(</span><span class="op">)</span>
  <span class="va">resultsInterpolated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">resultsInterpolated</span>, <span class="va">r</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">resultsInterpolated</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span>, y <span class="op">=</span> <span class="va">height</span>, color <span class="op">=</span> <span class="va">direction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">wafer</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Lateral position [um]"</span>,
       y <span class="op">=</span> <span class="st">"Height [nm]"</span>,
       color <span class="op">=</span> <span class="st">"Trace"</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-22-1.png" width="960"></p>
<p>For each wafer, four traces were measured, of which pairs of two
should be identical to each other: trace south-north measures the same
structure as north-south, and the same is true for traces east-west and
west-east. In above graph, this similarity is not obvious, because the
measurement directions are reversed (west-east goes left-to-right and
east-west the other way around). Therefore, two of the four traces have
to be reversed, so that the only measurement directions are
<em>top-to-bottom</em> and <em>left-to-right</em>. Furthermore, the data
will be centered around zero, so that the origin is located in the wafer
center.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mirror_and_center</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">resultsInterpolated</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">resultsInterpolated</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">wafer</span>, <span class="va">direction</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">position</span>, .by_group <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">direction</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"southnorth"</span>, <span class="st">"eastwest"</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>,
                                        <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="co"># center around zero</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">position</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now there is a lot more similarity going on in the height profiles.
Of the four traces, those in horizontal and vertical direction,
respectively, should be overlapping to a large degree.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heights</span> <span class="op">&lt;-</span> <span class="va">resultsInterpolated</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">mirror_and_center</span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">heights</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span>, y <span class="op">=</span> <span class="va">height</span>, color <span class="op">=</span> <span class="va">direction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">wafer</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Lateral position [um]"</span>,
       y <span class="op">=</span> <span class="st">"Height [nm]"</span>,
       color <span class="op">=</span> <span class="st">"Trace"</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-24-1.png" width="960"></p>
<p>For a single wafer:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heights</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">wafer</span> <span class="op">==</span> <span class="st">"job9946"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span>, y <span class="op">=</span> <span class="va">height</span>, color <span class="op">=</span> <span class="va">direction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Position from wafer center [um]"</span>,
       y <span class="op">=</span> <span class="st">"Height [nm]"</span>,
       color <span class="op">=</span> <span class="st">"Trace direction"</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p>The duplicate measurements of the horizontal and vertical structure
will be averaged.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">average_duplicate_traces</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">heights</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">rpm</span>, <span class="va">wafer</span>, <span class="va">spintime</span>, <span class="va">orientation</span>, <span class="va">position</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span>,
              height_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>,
              .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heights</span> <span class="op">&lt;-</span> <span class="va">heights</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">average_duplicate_traces</span><span class="op">(</span><span class="op">)</span>

<span class="va">heights</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span>, y <span class="op">=</span> <span class="va">height</span>, color <span class="op">=</span> <span class="va">orientation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Position from wafer center [um]"</span>,
       y <span class="op">=</span> <span class="st">"Height [nm]"</span>,
       color <span class="op">=</span> <span class="st">"Trace direction"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">wafer</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-27-1.png" width="960"></p>
<p>Finally, since the spin coating process should be radially
symmetrical more or less (ideally), I want to describe the height
profile as a function of the radial distance from the wafer center. To
that end, data with negative position coordinate will be flipped over
into the positive range.</p>
<p><img src="images/005_spincurve_cross_pattern_quadrants.png" alt="Spincurve cross pattern quadrants"> { width=50% }</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">make_radial</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">heights</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>quadrant <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">orientation</span> <span class="op">==</span> <span class="st">"vertical"</span> <span class="op">&amp;</span> <span class="va">position</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"south"</span>,
                                <span class="va">orientation</span> <span class="op">==</span> <span class="st">"vertical"</span> <span class="op">&amp;</span> <span class="va">position</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"north"</span>,
                                <span class="va">orientation</span> <span class="op">==</span> <span class="st">"horizontal"</span> <span class="op">&amp;</span> <span class="va">position</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"west"</span>,
                                <span class="va">orientation</span> <span class="op">==</span> <span class="st">"horizontal"</span> <span class="op">&amp;</span> <span class="va">position</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"east"</span>,
                                <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"ERROR"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="co"># flip values with negative position coordinate into positive range</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">position</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">~</span> <span class="op">-</span><span class="va">position</span>,
                                <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">heightsRadial</span> <span class="op">&lt;-</span> <span class="va">heights</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">make_radial</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">heightsRadial</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span>, y <span class="op">=</span> <span class="va">height</span>, color <span class="op">=</span> <span class="va">quadrant</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">wafer</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Distance from wafer center [um]"</span>,
       y <span class="op">=</span> <span class="st">"Height [nm]"</span>,
       color <span class="op">=</span> <span class="st">"Quadrant"</span><span class="op">)</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-29-1.png" width="960"></p>
<p>Plot by RPM and spintime:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">r</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">heightsRadial</span><span class="op">$</span><span class="va">rpm</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">heightsRadial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rpm</span> <span class="op">==</span> <span class="va">r</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">position</span><span class="op">*</span><span class="fl">1e-3</span>, y <span class="op">=</span> <span class="va">height</span><span class="op">*</span><span class="fl">1e-3</span>, color <span class="op">=</span> <span class="va">wafer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">25.4</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">wafer</span>, <span class="va">quadrant</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">spintime</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Distance from wafer center [mm]"</span>,
         y <span class="op">=</span> <span class="st">"Coating thickness [um]"</span>,
         linetype <span class="op">=</span> <span class="st">"Spintime [s]"</span>,
         color <span class="op">=</span> <span class="st">"Wafer id"</span>,
         title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">r</span>, <span class="st">"RPM"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="spincurves_files/figure-html/unnamed-chunk-30-1.png" width="700"><img src="spincurves_files/figure-html/unnamed-chunk-30-2.png" width="700"><img src="spincurves_files/figure-html/unnamed-chunk-30-3.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="conclusions">conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<ul>
<li>spin coating results in circular inner region of uniform thickness
and outer rim with thicker coating</li>
<li>spinning for longer time (60 instead of 30 s) seems to expand the
inner region</li>
<li>higher variation in thickness across wafers for lower RPM (3000,
4000)</li>
<li>place chip designs radially symmetrical on the wafer to increase
uniformness</li>
</ul>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">references<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-noauthor_su-8_nodate" class="csl-entry">
<span>“<span>SU</span>-8 3000 for Microstructure Fabrication
<span></span> Kayaku Advanced Materials. Kayaku Advanced Materials,
Inc.”</span> n.d. Accessed May 17, 2022. <a href="https://kayakuam.com/products/su-8-3000/" class="external-link">https://kayakuam.com/products/su-8-3000/</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Fynn Withake.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
