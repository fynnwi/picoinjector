<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="picoinjector">
<title>Volumes and Concentrations • picoinjector</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Volumes and Concentrations">
<meta property="og:description" content="picoinjector">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">picoinjector</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Calculations</h6>
    <a class="dropdown-item" href="../articles/volumes.html">Volumes and Concentrations</a>
    <a class="dropdown-item" href="../articles/fluidics.html">Fluid Flow</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Data analysis</h6>
    <a class="dropdown-item" href="../articles/spincurves.html">SU-8 3035 Spincurve Analysis</a>
    <a class="dropdown-item" href="../articles/logfiles.html">Log Files</a>
    <a class="dropdown-item" href="../articles/fads_analysis.html">FADS Analysis</a>
    <a class="dropdown-item" href="../articles/electrical_engineering.html">Electrical Engineering</a>
    <a class="dropdown-item" href="../articles/comsol.html">COMSOL Simulations</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Thesis</h6>
    <a class="dropdown-item" href="../articles/thesis_plots.html">Thesis Plots</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Volumes and Concentrations</h1>
            
      
      
      <div class="d-none name"><code>volumes.Rmd</code></div>
    </div>

    
    
<p>In this vignette, calculations to estimate volumes, concentrations
and other quantities relevant for the droplet making and picoinjection
workflow are documented.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">picoinjector</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="tubing">Tubing<a class="anchor" aria-label="anchor" href="#tubing"></a>
</h2>
<p>Volume of a cylinder with radius <span class="math inline">\(r\)</span> and height <span class="math inline">\(h\)</span>:</p>
<p><span class="math display">\[V = \pi r^2 h\]</span></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getCylinderVolume</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">radius</span>, <span class="va">height</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">radius</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">height</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Tubing options:</p>
<table class="table">
<thead><tr class="header">
<th>type</th>
<th>inner diameter</th>
<th>outer diameter</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Tygon</td>
<td>0.508 mm (0.020 in)</td>
<td>1.524 mm (0.060 in)</td>
</tr>
<tr class="even">
<td>PTFE 1</td>
<td>0.8 mm</td>
<td>1.6 mm</td>
</tr>
<tr class="odd">
<td>PTFE 2</td>
<td>0.3 mm</td>
<td>0.78 mm</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># everything in m</span></span>
<span><span class="va">radiusTygon</span> <span class="op">&lt;-</span> <span class="fl">0.508e-3</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="va">radiusPTFE1</span> <span class="op">&lt;-</span> <span class="fl">0.8e-3</span> <span class="op">/</span> <span class="fl">2</span></span>
<span><span class="va">radiusPTFE2</span> <span class="op">&lt;-</span> <span class="fl">0.3e-3</span> <span class="op">/</span> <span class="fl">2</span></span></code></pre></div>
<p>Plot the tubing volume as a function of tubing length for lengths up
to 1 meter:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">volumes</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>length <span class="op">=</span> <span class="va">length</span> <span class="op">*</span> <span class="fl">1e-3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># convert into mm</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>v_tygon <span class="op">=</span> <span class="fu">getCylinderVolume</span><span class="op">(</span><span class="va">radiusTygon</span>, <span class="va">length</span><span class="op">)</span>,</span>
<span>                v_ptfe_large <span class="op">=</span> <span class="fu">getCylinderVolume</span><span class="op">(</span><span class="va">radiusPTFE1</span>, <span class="va">length</span><span class="op">)</span>,</span>
<span>                v_ptfe_small <span class="op">=</span> <span class="fu">getCylinderVolume</span><span class="op">(</span><span class="va">radiusPTFE2</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">length</span>, names_to <span class="op">=</span> <span class="st">"type"</span>, values_to <span class="op">=</span> <span class="st">"volume"</span><span class="op">)</span></span>
<span><span class="va">volumes</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,000 × 3</span></span></span>
<span><span class="co">#&gt;    length type           volume</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  0.001 v_tygon      2.03<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  0.001 v_ptfe_large 5.03<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  0.001 v_ptfe_small 7.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-11</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  0.002 v_tygon      4.05<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  0.002 v_ptfe_large 1.01<span style="color: #949494;">e</span><span style="color: #BB0000;">- 9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  0.002 v_ptfe_small 1.41<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  0.003 v_tygon      6.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  0.003 v_ptfe_large 1.51<span style="color: #949494;">e</span><span style="color: #BB0000;">- 9</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  0.003 v_ptfe_small 2.12<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  0.004 v_tygon      8.11<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 2,990 more rows</span></span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">volumes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">volume</span> <span class="op">*</span> <span class="fl">1e9</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PTFE 1"</span>, <span class="st">"PTFE 2"</span>, <span class="st">"Tygon"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Tubing length [m]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tubing volume [µL]"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Tubing type"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"PTFE and Tygon tubing volume"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/PTFE_and_Tygon_tubing_volume-1.png" width="700"></p>
<p>Convert flowrate unit µl/h into tubing cm/h:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flowrates</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"ul_h"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"Tygon"</span> <span class="op">=</span> <span class="va">ul_h</span> <span class="op">/</span> <span class="op">(</span><span class="fu">getCylinderVolume</span><span class="op">(</span><span class="va">radiusTygon</span>, <span class="fl">0.01</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e9</span><span class="op">)</span>, </span>
<span>                <span class="st">"PTFE 1"</span> <span class="op">=</span> <span class="va">ul_h</span> <span class="op">/</span> <span class="op">(</span><span class="fu">getCylinderVolume</span><span class="op">(</span><span class="va">radiusPTFE1</span>, <span class="fl">0.01</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e9</span><span class="op">)</span>,</span>
<span>                <span class="st">"PTFE 2"</span> <span class="op">=</span> <span class="va">ul_h</span> <span class="op">/</span> <span class="op">(</span><span class="fu">getCylinderVolume</span><span class="op">(</span><span class="va">radiusPTFE2</span>, <span class="fl">0.01</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e9</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">ul_h</span>, names_to <span class="op">=</span> <span class="st">"tubing_type"</span>, values_to <span class="op">=</span> <span class="st">"cm_h"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">flowrates</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ul_h</span>, y <span class="op">=</span> <span class="va">cm_h</span> <span class="op">/</span> <span class="fl">60</span>, color <span class="op">=</span> <span class="va">tubing_type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flowrate [ul/h]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Tubing-length flowrate [cm/min]"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Tubing type"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Displacement rate in tubing [cm/min] vs. flowrate [µl/h]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/Flowrates_in_PTFE_and_Tygon_tubing-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="droplets">Droplets<a class="anchor" aria-label="anchor" href="#droplets"></a>
</h2>
<p>How much liquid is contained in a droplet of diameter <span class="math inline">\(d\)</span>?</p>
<p>Volume of a sphere: <span class="math display">\[V = \frac{4}{3} \pi
r^3\]</span></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getSphereVolume</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">radius</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">4</span><span class="op">/</span><span class="fl">3</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">radius</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Plot droplet volumes as function of diameter:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># 10-200 µm droplets</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"volume"</span> <span class="op">=</span> <span class="fu">getSphereVolume</span><span class="op">(</span><span class="va">diameter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diameter</span><span class="op">*</span><span class="fl">1e6</span>, y <span class="op">=</span> <span class="va">volume</span> <span class="op">*</span> <span class="fl">1e15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># y-axis in picoliters</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Droplet diameter [µm]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Droplet volume [pL]"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Droplet volume vs. diameter"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/Droplet_volume_vs_diameter-1.png" width="700"></p>
<p>For droplet sizes up to 40 µm:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/last_plot.html" class="external-link">last_plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">40</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">35</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/Droplet_volume_vs_diameter_2-1.png" width="700"></p>
<p>How many droplets are there in 1 ml of emulsion?</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">radiusDroplet</span> <span class="op">&lt;-</span> <span class="fl">15e-6</span> <span class="co"># 30 micron droplets</span></span></code></pre></div>
<p>Assuming close-packing of equal spheres: fraction of space occupied
by spheres is</p>
<p><span class="math display">\[\frac{\pi}{3 \sqrt{2}} \approx
0.74048\]</span></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getNumberOfClosePackedSpheres</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">radius</span>, <span class="va">volume</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">volumeSingleSphere</span> <span class="op">&lt;-</span> <span class="fl">4</span><span class="op">/</span><span class="fl">3</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">radius</span><span class="op">^</span><span class="fl">3</span></span>
<span>  <span class="va">packingDensity</span> <span class="op">&lt;-</span> <span class="va">pi</span><span class="op">/</span><span class="fl">3</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">packingDensity</span> <span class="op">*</span> <span class="va">volume</span> <span class="op">/</span> <span class="va">volumeSingleSphere</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Using this packing density, I can calculate the volume fraction
occupied by spheres. Dividing by the known volume of a single droplet
yields the total number of droplets contained in a given volume of
emulsion.</p>
<p>Plot number of droplets contained in 1 ml of emulsion vs. droplet
diameter:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-6</span>,</span>
<span>               <span class="st">"n_drops"</span> <span class="op">=</span> <span class="fu">getNumberOfClosePackedSpheres</span><span class="op">(</span><span class="va">diameter</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diameter</span> <span class="op">*</span> <span class="fl">1e6</span>, y <span class="op">=</span> <span class="va">n_drops</span> <span class="op">*</span> <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Number of close-packed equal spheres in 1 ml"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Sphere diameter [µm]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of spheres [million]"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>How many droplets are there in a given length of Tygon/PTFE
tubing?</p>
<p>Plot number of close-packed spheres over tubing length:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">volumes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_droplets <span class="op">=</span> <span class="fu">getNumberOfClosePackedSpheres</span><span class="op">(</span><span class="va">radiusDroplet</span>, <span class="va">volume</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">n_droplets</span><span class="op">*</span><span class="fl">1e-6</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PTFE 1"</span>, <span class="st">"PTFE 2"</span>, <span class="st">"Tygon"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Tubing length [m]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of close-packed spheres [million]"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Tubing type"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Number of droplets vs. tubing length"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/Number_of_droplets_vs._tubing_length-1.png" width="700"></p>
<p>Droplet frequency: Given a droplet diameter and a fixed emulsion flow
rate, how many droplets per second do I get?</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="st">"flowrate"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-9</span> <span class="op">/</span> <span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">60</span><span class="op">)</span>, <span class="co"># convert µl/h into m^3/s</span></span>
<span>                <span class="st">"diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">35</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"frequency"</span> <span class="op">=</span> <span class="fl">0.74</span><span class="op">*</span> <span class="va">flowrate</span> <span class="op">/</span> <span class="fu">getSphereVolume</span><span class="op">(</span><span class="va">diameter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flowrate</span> <span class="op">*</span> <span class="op">(</span><span class="fl">3600</span><span class="op">/</span><span class="fl">1e-9</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">frequency</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">diameter</span><span class="op">*</span><span class="fl">1e6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Droplet frequency vs. flowrate"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Droplet frequency [Hz]"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Flowrate [µl/h]"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Droplet diameter [µm]"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>        legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="section level3">
<h3 id="volume-increase-due-to-picoinjection">Volume increase due to picoinjection<a class="anchor" aria-label="anchor" href="#volume-increase-due-to-picoinjection"></a>
</h3>
<p>Described in <span class="citation">(Abate et al. 2010)</span> are
injected volumes in the range of 0.5-2 pl for ~ 40 µm droplets (not
mentioned in the paper). The injection volume range of the stepinjector
<span class="citation">(Hu et al. 2021)</span> is documented as 3.5-122
pl.</p>
<p>How does the diameter of my droplet increase when picoliter volumes
are added?</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="st">"radius"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">7.5</span>, <span class="fl">17.5</span>, <span class="fl">0.1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-6</span>,</span>
<span>                 <span class="st">"injected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-15</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"volume_before"</span> <span class="op">=</span> <span class="fu">getSphereVolume</span><span class="op">(</span><span class="va">radius</span><span class="op">)</span>,</span>
<span>                <span class="st">"volume_after"</span> <span class="op">=</span> <span class="va">volume_before</span> <span class="op">+</span> <span class="va">injected</span>,</span>
<span>                <span class="st">"radius_after"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">3</span><span class="op">/</span><span class="fl">4</span><span class="op">*</span><span class="va">volume_after</span><span class="op">/</span><span class="va">pi</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">radius</span><span class="op">*</span><span class="fl">1e6</span>, y <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">radius_after</span><span class="op">*</span><span class="fl">1e6</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">injected</span> <span class="op">*</span> <span class="fl">1e15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">30</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Droplet diameter [µm]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Droplet diameter after injection [µm]"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Injected volume [pl]"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Change in droplet size after picoinjection"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Conclusion:</p>
<p>Which concentration of cells do I need if picoliter volumes are
injected and on average 1/2/5 cells per droplet should be
encapsulated?</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="st">"injected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="co"># pl</span></span>
<span>                <span class="st">"lambda"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"concentration"</span> <span class="op">=</span> <span class="va">lambda</span><span class="op">/</span><span class="va">injected</span><span class="op">*</span><span class="fl">1e9</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">injected</span>, y <span class="op">=</span> <span class="va">concentration</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html" class="external-link">sec_axis</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="op">~</span><span class="va">.</span><span class="op">/</span><span class="fl">8e8</span>, name <span class="op">=</span> <span class="st">"Corresponding OD600 value"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Injected volume [pl]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cell concentration [cfu/ml]"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Average #cells per injection"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Required cell concentration vs. injected volume for a given mean number of cells per injection"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>        legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="cells">Cells<a class="anchor" aria-label="anchor" href="#cells"></a>
</h2>
<p>How does the volume of a cell compare to that of a droplet?</p>
<p>Approximate dimensions of a typical <em>E.coli</em> cell:</p>
<ul>
<li>diameter = 1 µm</li>
<li>length = 2 µm</li>
<li>volume = 1.3 µm^3</li>
</ul>
<p>Neglecting the packing, plot how many <em>E.coli</em> cells
theoretically fit in one droplet:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vEcoli</span> <span class="op">&lt;-</span> <span class="fl">1.3e-18</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">40</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e-6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># 10-200 µm droplets</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"volume"</span> <span class="op">=</span> <span class="fu">getSphereVolume</span><span class="op">(</span><span class="va">diameter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                <span class="st">"n_cells"</span> <span class="op">=</span> <span class="va">volume</span><span class="op">/</span><span class="va">vEcoli</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">diameter</span><span class="op">*</span><span class="fl">1e6</span>, y <span class="op">=</span> <span class="va">n_cells</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># y-axis in picoliters</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Droplet diameter [µm]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Number of cells equivalent to droplet volume"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Number of E.coli cells equivalent to droplet volume vs. droplet diameter"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/Number_of_Ecoli_cells_equivalent_to_droplet_volume_vs_droplet_diameter-1.png" width="700"></p>
<p>How many mCherry molecules are there in one bacterium, and what is
the mCherry concentration in the droplet after cell lysis?</p>
<p>The motivation for this question is the following: In the end, we
want to capture those droplets that contained a phage that successfully
managed to kill the bacteria. While a droplet containing an intact cell
causes a narrow signal of high magnitude after excitation by the laser,
a droplet whose cells were lysed should result in a broader,
low-intensity signal, since its volumetric concentration of fluorescent
protein is much smaller. However, it is not clear, whether this low
signal can be distinguished from the background noise that is present at
any given time.</p>
</div>
<div class="section level2">
<h2 id="poisson-statistics">Poisson statistics<a class="anchor" aria-label="anchor" href="#poisson-statistics"></a>
</h2>
<p>From <span class="citation">(Collins et al. 2015)</span> about
single-cell encapsulation:</p>
<ul>
<li>when number of encapsulated cells is large and size is significantly
smaller than the droplet (e.g. bacterial cells), the number of cells per
droplet can be representative of the volumetric concentration of cells
<ul>
<li>number of cells can be approximated by a Gaussian distribution</li>
<li>not the case for single-cell analysis</li>
</ul>
</li>
<li>if cells are distributed randomly in the aqueous phase, the quantity
of cells per droplet is determined by Poisson statistics</li>
<li>probabilistically estimate the proportion of single cells that are
encapsulated according to the Poisson distribution, which is applicable
in the case where the average cell arrival rate is known and the arrival
of individual cells occurs independently from other cells</li>
</ul>
<p>Poisson distribution:</p>
<p><span class="math display">\[p(k, \lambda) = \frac{\lambda^k
e^{-\lambda}}{k!}\]</span></p>
<ul>
<li>
<span class="math inline">\(k\)</span> number of particles in a
droplet</li>
<li>
<span class="math inline">\(\lambda\)</span> average number of cells
per droplet volume</li>
</ul>
<p>Plot the Poisson distribution for different <span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span><span class="st">"k"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>,</span>
<span>                <span class="st">"lambda"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"p"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">dpois</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">k</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">22</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Poisson distribution for different values of lambda"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"p(k, lambda)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"k"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"lambda"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/Poisson_distribution_for_different_values_of_lambda-1.png" width="700"></p>
<div class="section level3">
<h3 id="volume-inference-via-poisson-statistics">Volume inference via Poisson statistics<a class="anchor" aria-label="anchor" href="#volume-inference-via-poisson-statistics"></a>
</h3>
<p>Idea: Count how many droplets were injected with 0/1/2/3… cells and
then determine the lambda that best fits the Poisson distribution to
this data. If the bulk concentration of the injected phase is known
precisely, I can use it to infer the injected volume. From that, I can
then derive the change in droplet size.</p>
<p>Calculation example:</p>
<p>Let the cell concentration of the injected phase <span class="math inline">\(c_0 = 0.5 \cdot 10^9 \mathrm{cfu/ml}\)</span>.
After picoinjection, the following droplet population was recorded:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"cells_per_droplet"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">7</span><span class="op">)</span>,</span>
<span>               <span class="st">"n_droplets"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">26</span>, <span class="fl">26</span>, <span class="fl">17</span>, <span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">counts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   cells_per_droplet n_droplets</span></span>
<span><span class="co">#&gt;               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                 0         13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                 1         26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                 2         26</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                 3         17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>                 4         10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>                 5          5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>                 6          2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>                 7          1</span></span></code></pre></div>
<p>Now I want to find the parameter <span class="math inline">\(\hat{\lambda}\)</span> that best explains the
observed data. This corresponds to the maximum likelihood estimate of
the Poisson distribution which is simply the sample mean:</p>
<p><span class="math display">\[\hat{\lambda}_\mathrm{MLE} = \frac{1}{n}
\sum_{i=1}^n k_i\]</span></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">counts</span><span class="op">$</span><span class="va">cells_per_droplet</span>, <span class="va">counts</span><span class="op">$</span><span class="va">n_droplets</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.13</span></span></code></pre></div>
<p>For above data, <span class="math inline">\(\hat{\lambda}_\mathrm{MLE} = 2.13\)</span> with
the unit <span class="math inline">\(\mathrm{cfu/V_{injected}}\)</span>.</p>
<p>Using the known concentration <span class="math inline">\(c_0\)</span> of my injected phase, I can now infer
the injected volume as</p>
<p><span class="math display">\[\mathrm {V_{inj}} = \frac{2.13 \;
\mathrm{cfu}}{0.5 \cdot 10^9 \; \mathrm{cfu/ml}} = 4.26 \cdot 10^{-9} \;
\mathrm{ml} = 4.26 \; \mathrm{pl}\]</span></p>
<p>(Numbers of the example data were chosen to approximate picoinjection
of 5 pl with on average 2 cells encapsulated per droplet)</p>
<p>How sensitive is this estimate w.r.t. the parameters of this system
(i.e. cell concentration <span class="math inline">\(c_0\)</span> and
droplet counts)?</p>
<p>Implement a function that performs above calculation:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infer_injected_volume</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">poissonCounts</span>, <span class="va">c0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">lambda_mle</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">poissonCounts</span><span class="op">[[</span><span class="st">"cells_per_droplet"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                     <span class="va">poissonCounts</span><span class="op">[[</span><span class="st">"n_droplets"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">v_injected</span> <span class="op">&lt;-</span> <span class="va">lambda_mle</span><span class="op">/</span><span class="va">c0</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">v_injected</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Simulate some variance in the measured data:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"concentration"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.01</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e9</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"v_injected"</span> <span class="op">=</span> <span class="fu">infer_injected_volume</span><span class="op">(</span><span class="va">counts</span>, <span class="va">concentration</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">concentration</span>, y <span class="op">=</span> <span class="va">v_injected</span><span class="op">*</span><span class="fl">1e9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0.5e9</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Bulk concentration [cfu/ml]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Injected volume [pl]"</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="volumes_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Disadvantages of this approach:</p>
<ul>
<li>only works if either:
<ul>
<li>I can detect the number of injected cells using the nyancat (i.e. in
real time), or</li>
<li>I keep the same parameters for the same experiment and image
afterwards on the Nikon</li>
</ul>
</li>
<li>I have to get the initial concentration of cells right in order to
land in a range of number of injected cells that allows to count
them</li>
</ul>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-abate_high-throughput_2010" class="csl-entry">
Abate, Adam R., Tony Hung, Pascaline Mary, Jeremy J. Agresti, and David
A. Weitz. 2010. <span>“High-Throughput Injection with Microfluidics
Using Picoinjectors.”</span> <em>Proceedings of the National Academy of
Sciences</em> 107 (45): 19163–66. <a href="https://doi.org/10.1073/pnas.1006888107" class="external-link">https://doi.org/10.1073/pnas.1006888107</a>.
</div>
<div id="ref-collins_poisson_2015" class="csl-entry">
Collins, David J., Adrian Neild, Andrew deMello, Ai-Qun Liu, and Ye Ai.
2015. <span>“The Poisson Distribution and Beyond: Methods for
Microfluidic Droplet Production and Single Cell Encapsulation.”</span>
<em>Lab on a Chip</em> 15 (17): 3439–59. <a href="https://doi.org/10.1039/C5LC00614G" class="external-link">https://doi.org/10.1039/C5LC00614G</a>.
</div>
<div id="ref-hu_tunable_2021" class="csl-entry">
Hu, Beiyu, Shun Ye, Dongwei Chen, Bingliang Xie, Ran Hu, Yuxin Qiao,
Yanghuan Yu, et al. 2021. <span>“Tunable and Contamination-Free
Injection with Microfluidics by Stepinjection.”</span> <em>Analytical
Chemistry</em> 93 (39): 13112–17. <a href="https://doi.org/10.1021/acs.analchem.1c02721" class="external-link">https://doi.org/10.1021/acs.analchem.1c02721</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Fynn Withake.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
