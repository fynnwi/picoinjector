<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="picoinjector">
<title>FADS-based Picoinjector Characterization • picoinjector</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="FADS-based Picoinjector Characterization">
<meta property="og:description" content="picoinjector">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">picoinjector</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Calculations</h6>
    <a class="dropdown-item" href="../articles/volumes.html">Volumes and Concentrations</a>
    <a class="dropdown-item" href="../articles/fluidics.html">Fluid Flow</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Data analysis</h6>
    <a class="dropdown-item" href="../articles/spincurves.html">SU-8 3035 Spincurve Analysis</a>
    <a class="dropdown-item" href="../articles/logfiles.html">Log Files</a>
    <a class="dropdown-item" href="../articles/fads_analysis.html">FADS Analysis</a>
    <a class="dropdown-item" href="../articles/fads_picoinjector_characterization.html">FADS-based Picoinjector Characterization</a>
    <a class="dropdown-item" href="../articles/electrical_engineering.html">Electrical Engineering</a>
    <a class="dropdown-item" href="../articles/comsol.html">COMSOL Simulations</a>
    <a class="dropdown-item" href="../articles/pressures.html">Pressures</a>
    <a class="dropdown-item" href="../articles/droplet_image_analysis.html">Droplet Image Analysis</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Thesis</h6>
    <a class="dropdown-item" href="../articles/thesis_plots.html">Thesis Plots</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>FADS-based Picoinjector Characterization</h1>
            
      
      
      <div class="d-none name"><code>fads_picoinjector_characterization.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">picoinjector</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/karthik/wesanderson" class="external-link">wesanderson</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="picoinjecting-black-ink-and-recording-videos-at-4000-fps">Picoinjecting black ink and recording videos at 4000 fps<a class="anchor" aria-label="anchor" href="#picoinjecting-black-ink-and-recording-videos-at-4000-fps"></a>
</h2>
<p>Black ink was injected into ~ 30 µm droplets and videos were recorded
using a high-speed camera. The footage was processed using ImageJ and
MATLAB in order to detect droplets and determine their size. The sizes
of recognized droplets were stored in text files.</p>
<p>Read the data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/fads/221216/ink/"</span>, pattern <span class="op">=</span> <span class="st">"_kymograph_droplets.txt$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">droplets</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="va">files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">droplets</span> <span class="op">&lt;-</span> <span class="va">droplets</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>      <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span><span class="va">f</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"file"</span> <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, <span class="st">"\\d{8}_\\d{6}"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="co"># normalize intensity by droplet width</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"intensity"</span> <span class="op">=</span> <span class="va">intensity</span><span class="op">/</span><span class="va">width</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># add metadata</span></span>
<span><span class="va">droplets</span> <span class="op">&lt;-</span> <span class="va">droplets</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span><span class="st">"data/fads/221216/ink/metadata.txt"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"file"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now, plot the measured droplet sizes and check if they make
sense:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">droplets</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"q_emulsion"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">q_emulsion</span><span class="op">)</span>,</span>
<span>         <span class="st">"p_oil"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">p_oil</span><span class="op">)</span>,</span>
<span>         <span class="st">"p_water"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">p_water</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">p_water</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, position <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">p_oil</span> <span class="op">~</span> <span class="va">q_emulsion</span>, labeller <span class="op">=</span> <span class="va">label_both</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="section level3">
<h3 id="single-file-level">Single-file level<a class="anchor" aria-label="anchor" href="#single-file-level"></a>
</h3>
<p>Summarize the droplet populations for every file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dropletSummary</span> <span class="op">&lt;-</span> <span class="va">droplets</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">p_oil</span>, <span class="va">q_emulsion</span>, <span class="va">p_water</span>, <span class="va">ac_field</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"mean_diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"median_diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"sd_diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"intensity_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span>,</span>
<span>                   <span class="st">"intensity_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span>,</span>
<span>                   <span class="st">"intensity_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">intensity</span><span class="op">)</span>,</span>
<span>                   <span class="st">"n_droplets"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'file', 'p_oil', 'q_emulsion', 'p_water'.</span></span>
<span><span class="co">#&gt; You can override using the `.groups` argument.</span></span>
<span><span class="va">dropletSummary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 12</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   file, p_oil, q_emulsion, p_water [14]</span></span></span>
<span><span class="co">#&gt;    file    p_oil q_emu…¹ p_water ac_fi…² mean_…³ media…⁴ sd_di…⁵ inten…⁶ inten…⁷</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 202212…   260      35     131 FALSE      31.2    30      5.27    327.    331.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 202212…    80      15      60 TRUE       33.8    33.5    1.73    128.    129.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 202212…   115      15      60 TRUE       32.0    32.2    2.12    131.    136.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 202212…   115      15      70 TRUE       34.8    34.8    1.76    126.    129.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 202212…   115      15      80 TRUE       37.8    37.8    1.70    114.    115.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 202212…   130      15      80 TRUE       36.0    36.1    1.80    106.    107.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 202212…   130      25      80 TRUE       34.7    35.2    2.43    130.    130.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 202212…   145      25      80 TRUE       33.3    33.5    3.71    160.    154.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 202212…   145      25      70 TRUE       31.0    31.7    2.72    197.    187.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 202212…   145      25      70 TRUE       32.1    31.7    5.06    246.    234.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 202212…   145      35      70 TRUE       33.8    33.9    2.84    135.    134.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 202212…   160      35      70 TRUE       32.6    33.5    3.00    145.    137.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 202212…   160      35      70 TRUE       31.5    32.2    3.12    134.    126.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 202212…   160      35      70 TRUE       30.9    30.9    3.71    139.    135.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 2 more variables: intensity_sd &lt;dbl&gt;, n_droplets &lt;int&gt;, and</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   abbreviated variable names ¹​q_emulsion, ²​ac_field, ³​mean_diameter,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁴​median_diameter, ⁵​sd_diameter, ⁶​intensity_mean, ⁷​intensity_median</span></span></span></code></pre></div>
<p>The median diameter of uninjected droplets is 30 µm.</p>
<p>Since pressure and flow rate are related linearly in the
Hagen-Poisseuille model, I will summarize the two variables into a
single ratio p_oil/q_emulsion I somehow want to express the droplet
velocity in terms of p_oil and q_emulsion. For q_emulsion it would be
straightforward, but the spacing oil is driven by pressure, which makes
the flow rate harder to estimate. I will just use the Hagen-Poisseuille
law with a hydraulic resistance value from literature to convert
pressure into flow rate, and then add it to the emulsion flow rate.</p>
<p><span class="math display">\[R_h =\frac{12 \eta L}{1-0.63(h/w)}
\frac{1}{h^3w}\]</span></p>
<p>For the dynamic viscosity I use that of FC-40 fluorinert oil which
according to <a href="https://www.matweb.com/search/DataSheet.aspx?MatGUID=2072a809f9ca4d529b1d136660736f81&amp;ckck=1" class="external-link">this</a>
source is 4.1 mPa s. For the channel dimensions I use L = 0.5 mm, h = 30
µm, w = 20 µm (approximate length of the most confined channel
segment)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_h</span> <span class="op">&lt;-</span>  <span class="fl">12</span> <span class="op">*</span> <span class="fl">4.1e-3</span> <span class="op">*</span> <span class="fl">0.5e-3</span> <span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.63</span><span class="op">*</span><span class="op">(</span><span class="fl">30e-6</span> <span class="op">/</span> <span class="fl">20e-6</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">30e-6</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span> <span class="op">*</span> <span class="fl">20e-6</span><span class="op">)</span></span>
<span><span class="va">dropletSummary</span> <span class="op">&lt;-</span> <span class="va">dropletSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"q_oil_est"</span> <span class="op">=</span> <span class="va">p_oil</span> <span class="op">*</span> <span class="fl">1e2</span><span class="op">/</span><span class="va">r_h</span> <span class="op">*</span> <span class="fl">3.6e12</span><span class="op">)</span> <span class="co"># in ml/h</span></span></code></pre></div>
<p>Idea: emulsion flow rate negligible compared to spacing oil flow
rate, which is usually at least five times larger. Therefore, express
p_oil and p_injection as a ratio:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_volume_change</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">diameter1</span>, <span class="va">diameter0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">6</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="va">diameter1</span><span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="va">diameter0</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/wesanderson/man/wes_palette.html" class="external-link">wes_palette</a></span><span class="op">(</span><span class="st">"Zissou1"</span>, <span class="fl">100</span>, type <span class="op">=</span> <span class="st">"continuous"</span><span class="op">)</span></span>
<span><span class="va">dropletSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"water_oil_ratio"</span> <span class="op">=</span> <span class="va">p_water</span><span class="op">/</span><span class="va">p_oil</span>,</span>
<span>         <span class="st">"injected_volume"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">median_diameter</span> <span class="op">*</span> <span class="fl">1e-6</span>, <span class="va">get_volume_change</span>, <span class="fl">30e-6</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e15</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">water_oil_ratio</span>, y <span class="op">=</span> <span class="va">injected_volume</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">pal</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># geom_hline(yintercept = 30, linetype = "dashed") + </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">q_emulsion</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="st">"injection"</span><span class="op">]</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="st">"oil"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Injected volume [pL]"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Emulsion flow rate [µl/h]"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Picoinjected volumes are largest at low throughput and relatively high injection pressure"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span>, direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Lets investigate the grey intensities.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dropletSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"water_oil_ratio"</span> <span class="op">=</span> <span class="va">p_water</span><span class="op">/</span><span class="va">p_oil</span>,</span>
<span>         <span class="st">"injected_volume"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">median_diameter</span> <span class="op">*</span> <span class="fl">1e-6</span>, <span class="va">get_volume_change</span>, <span class="fl">30e-6</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e15</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">injected_volume</span>, y <span class="op">=</span> <span class="va">intensity_median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># geom_hline(yintercept = 30, linetype = "dashed") + </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">water_oil_ratio</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># scale_fill_viridis_c() +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">pal</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Injected volume [pL]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Median droplet gray value"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Pixel intensity decreases when picoinjecting ink"</span>,</span>
<span>       fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="st">"injection"</span><span class="op">]</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="st">"oil"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>        legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># guides(fill = </span></span>
<span>  <span class="co">#          guide_legend(title.position = "top", direction= "horizontal", ))</span></span></code></pre></div>
<p>Information I can take from this plot:</p>
<ul>
<li>with larger injection volume, more ink is injected, the pixel
intensity decreases</li>
<li>high variability</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(ggridges)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># droplets %&gt;% </span></span>
<span><span class="co">#   group_by(file) %&gt;%</span></span>
<span><span class="co">#   filter(width &gt; quantile(width, 0.1) &amp; width &lt; quantile(width, 0.9)) %&gt;% # remove outliers</span></span>
<span><span class="co">#   ungroup() %&gt;% </span></span>
<span><span class="co">#   ggplot(aes(x = width, y = file)) + </span></span>
<span><span class="co">#   scale_fill_gradientn(colours = pal) +</span></span>
<span><span class="co">#   geom_vline(xintercept = 30) + </span></span>
<span><span class="co">#   geom_density_ridges(aes(fill = p_water/p_oil)) + </span></span>
<span><span class="co">#   theme_pretty_thesis() + facet_wrap(~factor(q_emulsion), ncol = 1)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="picoinjecting-atto488-into-resorufin-droplets-2023-01-26">Picoinjecting Atto488 into resorufin droplets (2023-01-26)<a class="anchor" aria-label="anchor" href="#picoinjecting-atto488-into-resorufin-droplets-2023-01-26"></a>
</h2>
<p>In order to characterize the picoinjector operating range, 30 µm
resorufin droplets were injected with Att488 dye. Fluorescence
activities of the droplets were measured during operation using the
FADS-setup. Waveform files corresponding to the signals arriving at the
two PMT tubes were recorded and analyzed using MATLAB code, and TSV
files containing information of the droplets identified in the signal
were generated. These will be analysed in this vignette.</p>
<div class="section level3">
<h3 id="single-droplet-level">Single-droplet level<a class="anchor" aria-label="anchor" href="#single-droplet-level"></a>
</h3>
<p>Load the TSV data. Each row corresponds to a droplet. Droplet
populations resulting from 34 different parameter combinations were
collected. I exclude file <code>Signal_29</code> because picoinjection
didn’t work well for those parameters.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">greenAll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fads_read_all.html">fads_read_all</a></span><span class="op">(</span><span class="st">"data/fads/230126/"</span>, <span class="st">"_barcode.txt$"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">file</span> <span class="op">!=</span> <span class="st">"Signal_29"</span><span class="op">)</span> </span>
<span><span class="va">redAll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fads_read_all.html">fads_read_all</a></span><span class="op">(</span><span class="st">"data/fads/230126/"</span>, <span class="st">"_injected.txt$"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">file</span> <span class="op">!=</span> <span class="st">"Signal_29"</span><span class="op">)</span> </span>
<span><span class="va">greenAll</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,651,225 × 11</span></span></span>
<span><span class="co">#&gt;    t_start   t_max   t_end voltage   width spacing    area injec…¹    id occup…²</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0.002<span style="text-decoration: underline;">88</span> 0.003<span style="text-decoration: underline;">61</span> 0.004<span style="text-decoration: underline;">22</span> 0.006<span style="text-decoration: underline;">00</span> 0.001<span style="text-decoration: underline;">33</span> 0.003<span style="text-decoration: underline;">14</span> 5.82<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       0     1       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 0.007<span style="text-decoration: underline;">36</span> 0.008<span style="text-decoration: underline;">16</span> 0.009<span style="text-decoration: underline;">26</span> 0.010<span style="text-decoration: underline;">8</span>  0.001<span style="text-decoration: underline;">9</span>  0.002<span style="text-decoration: underline;">18</span> 1.22<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>       1     2       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0.011<span style="text-decoration: underline;">4</span>  0.012<span style="text-decoration: underline;">2</span>  0.012<span style="text-decoration: underline;">8</span>  0.006<span style="text-decoration: underline;">34</span> 0.001<span style="text-decoration: underline;">33</span> 0.001<span style="text-decoration: underline;">92</span> 6.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       0     3       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 0.014<span style="text-decoration: underline;">7</span>  0.015<span style="text-decoration: underline;">4</span>  0.016<span style="text-decoration: underline;">0</span>  0.006<span style="text-decoration: underline;">52</span> 0.001<span style="text-decoration: underline;">32</span> 0.001<span style="text-decoration: underline;">40</span> 6.23<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       0     4       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 0.017<span style="text-decoration: underline;">4</span>  0.018<span style="text-decoration: underline;">2</span>  0.018<span style="text-decoration: underline;">7</span>  0.007<span style="text-decoration: underline;">01</span> 0.001<span style="text-decoration: underline;">27</span> 0.001<span style="text-decoration: underline;">64</span> 6.25<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       1     5       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0.020<span style="text-decoration: underline;">3</span>  0.021<span style="text-decoration: underline;">0</span>  0.021<span style="text-decoration: underline;">6</span>  0.006<span style="text-decoration: underline;">74</span> 0.001<span style="text-decoration: underline;">30</span> 0.001<span style="text-decoration: underline;">4</span>  6.27<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       1     6       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0.023<span style="text-decoration: underline;">0</span>  0.023<span style="text-decoration: underline;">8</span>  0.024<span style="text-decoration: underline;">4</span>  0.006<span style="text-decoration: underline;">80</span> 0.001<span style="text-decoration: underline;">32</span> 0.001<span style="text-decoration: underline;">94</span> 6.48<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       1     7       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0.026<span style="text-decoration: underline;">3</span>  0.027<span style="text-decoration: underline;">0</span>  0.027<span style="text-decoration: underline;">6</span>  0.006<span style="text-decoration: underline;">62</span> 0.001<span style="text-decoration: underline;">28</span> 0.001<span style="text-decoration: underline;">40</span> 6.09<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       1     8       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0.029<span style="text-decoration: underline;">0</span>  0.029<span style="text-decoration: underline;">7</span>  0.030<span style="text-decoration: underline;">2</span>  0.007<span style="text-decoration: underline;">04</span> 0.001<span style="text-decoration: underline;">23</span> 0.002<span style="text-decoration: underline;">03</span> 6.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       1     9       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0.032<span style="text-decoration: underline;">2</span>  0.032<span style="text-decoration: underline;">9</span>  0.033<span style="text-decoration: underline;">5</span>  0.006<span style="text-decoration: underline;">31</span> 0.001<span style="text-decoration: underline;">28</span> 0.001<span style="text-decoration: underline;">54</span> 5.68<span style="color: #949494;">e</span><span style="color: #BB0000;">-6</span>       1    10       1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 2,651,215 more rows, 1 more variable: file &lt;chr&gt;, and abbreviated</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   variable names ¹​injected, ²​occupancy</span></span></span></code></pre></div>
<p>The information for which times the AC field was on/off, as well as
pressures and flow rates are stored in a metadata text file:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span><span class="st">"data/fads/230126/metadata.txt"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">metadata</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 34 × 9</span></span></span>
<span><span class="co">#&gt;    file     q_oil p_water q_emulsion ac_v_pp ac_frequency t_off video    laser…¹</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Signal_0   150     125         25       5           50 103.  2023012…       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Signal_1   150     115         25       5           50  95.3 2023012…       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Signal_2   150     105         25       5           50  85.9 2023012…       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Signal_3   150      95         25       5           50 112.  2023012…       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Signal_4   150      85         25       5           50  99.4 2023012…       1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Signal_5   150     130         25       5           50  91.9 2023012…       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Signal_6   150     140         25       5           50  65.2 2023012…       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Signal_7   300     120         50       5           50  42.4 2023012…       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Signal_8   300     130         50       5           50  51.2 2023012…       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Signal_9   300     140         50       5           50  27.3 2023012…       2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 24 more rows, and abbreviated variable name ¹​laser_focus</span></span></span></code></pre></div>
<p>Convert the generator signal voltage to the amplified peak-to-peak
voltage applied to the electrodes. For that I use the linear regression
fit calculated in <code><a href="../articles/electrical_engineering.html">vignette("electrical_engineering")</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"ac_v_pp"</span> <span class="op">=</span> <span class="va">ac_v_pp</span> <span class="op">*</span> <span class="fl">52.08425</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># also remove the 'video' column</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">video</span><span class="op">)</span></span></code></pre></div>
<p>Using the information on flow rates as well as the channel
dimensions, I can furthermore estimate the droplet velocity at which the
droplets pass the injection junction by simply dividing the total flow
rate (i.e. emulsion + spacing oil) by the known microchannel cross
section. To account for the different units I use 1 µl = 1e9 µm³.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"velocity"</span> <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">q_emulsion</span><span class="op">+</span><span class="va">q_oil</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e9</span><span class="op">/</span><span class="fl">3600</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">20</span><span class="op">*</span><span class="fl">30</span><span class="op">)</span><span class="op">*</span><span class="fl">1e-6</span><span class="op">)</span> <span class="co"># m/s</span></span></code></pre></div>
<p>Now I want to join the metadata to the signal data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grn</span> <span class="op">&lt;-</span> <span class="va">greenAll</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"ac_field"</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">t_max</span> <span class="op">&lt;</span> <span class="va">t_off</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>                                             .default <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">red</span> <span class="op">&lt;-</span> <span class="va">redAll</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"ac_field"</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">t_max</span> <span class="op">&lt;</span> <span class="va">t_off</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>                                             .default <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Furthermore, by knowing the droplet velocity, I can go transform the
signal width, which is a period of time, into an actual spatial width in
units of length. To that end, I have to multiply the peak width by the
droplet velocity to get the spatial length of the droplet.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grn</span> <span class="op">&lt;-</span> <span class="va">grn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"width_um"</span> <span class="op">=</span> <span class="va">width</span> <span class="op">*</span> <span class="va">velocity</span> <span class="op">*</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span><span class="va">red</span> <span class="op">&lt;-</span> <span class="va">red</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"width_um"</span> <span class="op">=</span> <span class="va">width</span> <span class="op">*</span> <span class="va">velocity</span> <span class="op">*</span> <span class="fl">1e6</span><span class="op">)</span></span>
<span><span class="va">grn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">q_emulsion</span>, <span class="va">q_oil</span>, <span class="va">p_water</span>, <span class="va">ac_field</span>, <span class="va">width</span> , <span class="va">width_um</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,651,225 × 7</span></span></span>
<span><span class="co">#&gt;    file     q_emulsion q_oil p_water ac_field   width width_um</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">33</span>    108. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">9</span>     154. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">33</span>    108. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">32</span>    107. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">27</span>    103. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">30</span>    105. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">32</span>    107. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">28</span>    103. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">23</span>     99.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Signal_0         25   150     125 TRUE     0.001<span style="text-decoration: underline;">28</span>    104. </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 2,651,215 more rows</span></span></span></code></pre></div>
<p>Obviously, these numbers are too large to represent droplet
diameters. One must account for the fact that droplets are still
squeezed in the microchannel, and appear therefore much longer.</p>
<p>We can convert the measured squeezed squeezed length into an
equivalent spherical droplet diameter: In the confined picoinjection
junction, 30µm droplets are squeezed into an elongated shape that can be
approximated by an elliptical cylinder with half-ellipsoids on each end.
The volume of an ellipsoid with semi-axes <span class="math inline">\(a,
b, c\)</span> is <span class="math display">\[V_e = \frac{4}{3} \pi a b
c.\]</span></p>
<p>The volume of an elliptical cylinder with semi-axes <span class="math inline">\(a, b\)</span> and length <span class="math inline">\(L\)</span> computes as <span class="math display">\[V_c = \pi a b L.\]</span></p>
<p>The droplet volume can than be approximated by <span class="math inline">\(V_d = V_e + V_c\)</span>: <span class="math display">\[V_d = V_e + V_c = \frac{4}{3} \pi a b c + \pi a b
L.\]</span> Lets say <span class="math inline">\(c\)</span> is the
ellipsoid radius along the axis in direction of the channel, <span class="math inline">\(a\)</span> the radius in the lateral direction
(i.e. half of the channel width), and <span class="math inline">\(b\)</span> the radius in z-direction (i.e. half of
the channel height). The signal measured by the PMT then corresponds to
the full length of the droplet <span class="math inline">\(L+2c\)</span>.</p>
<p>Assuming <span class="math inline">\(c = \frac{1}{2}(a+b)\)</span>
and rearranging for <span class="math inline">\(V_d\)</span> yields:
<span class="math display">\[V_d = \pi a b \left( \frac{2}{3} (a+b) + L
\right).\]</span></p>
<p>The radius of the droplet in a perfectly spherical shape can then be
found as <span class="math display">\[r = \left(\frac{3}{4}
\frac{V_d}{\pi}\right)^{1/3}.\]</span></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">squeezed_length_to_diameter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">signalWidth</span>, <span class="va">channelWidth</span>, <span class="va">channelHeight</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># if the droplet is not squeezed, l is already the diamteer of a spheere</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">channelWidth</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">channelHeight</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">signalWidth</span> <span class="op">&lt;</span> <span class="va">a</span><span class="op">+</span><span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">signalWidth</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># else...</span></span>
<span>  <span class="co"># get volume of the corresponding half sphere-cylinder</span></span>
<span>  <span class="va">vSphere</span> <span class="op">=</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">a</span> <span class="op">*</span> <span class="va">b</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span><span class="op">*</span><span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="va">b</span><span class="op">)</span> <span class="op">+</span> <span class="va">signalWidth</span><span class="op">-</span><span class="va">a</span><span class="op">-</span><span class="va">b</span><span class="op">)</span></span>
<span>  <span class="co"># return diameter of a same-volume sphere</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fl">3</span><span class="op">/</span><span class="fl">4</span> <span class="op">*</span> <span class="va">vSphere</span><span class="op">/</span><span class="va">pi</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># inverse function...</span></span>
<span><span class="va">diameter_to_squeezed_length</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">diameter</span>, <span class="va">channelWidth</span>, <span class="va">channelHeight</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># if the droplet is not squeezed, l is already the diameter of a spheere</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">channelWidth</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">channelHeight</span><span class="op">/</span><span class="fl">2</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">diameter</span> <span class="op">&lt;</span> <span class="va">a</span><span class="op">+</span><span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">diameter</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># else...</span></span>
<span>  <span class="co"># get volume of the corresponding half sphere-cylinder</span></span>
<span>  <span class="va">vsphere</span> <span class="op">=</span> <span class="fl">4</span><span class="op">/</span><span class="fl">3</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span><span class="op">(</span><span class="va">diameter</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span></span>
<span>  <span class="va">signalWidth</span> <span class="op">&lt;-</span> <span class="va">vsphere</span><span class="op">/</span><span class="op">(</span><span class="va">pi</span><span class="op">*</span><span class="va">a</span><span class="op">*</span><span class="va">b</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">/</span><span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="va">a</span><span class="op">+</span><span class="va">b</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">signalWidth</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"signal"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">signal</span>, <span class="va">squeezed_length_to_diameter</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">signal</span>, y <span class="op">=</span> <span class="va">diameter</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Droplet diameter as function of PMT signal spatial width. For unsqueezed droplets, the signal is equal to the diameter."</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"PMT signal width converted into [µm]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Corresponding sphere diameter [µm]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">"diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">diameter</span>, <span class="va">diameter_to_squeezed_length</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">length</span>, y <span class="op">=</span> <span class="va">diameter</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty.html">theme_pretty</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Droplet diameter as function of PMT signal spatial width. For unsqueezed droplets, the signal is equal to the diameter."</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"PMT signal width converted into [µm]"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Corresponding sphere diameter [µm]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-17-1.png" width="700">
These calculated widths/diameters represent a flow rate normalization,
therefore, the uninjected (i.e. field OFF) droplet populations should
now all have the same <code>width_um</code> value, regardless of the
flow rate. That is, if no measurement artifacts become important when
scaling up the flow rates.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">ac_field</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>median_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">width_um</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"corresponding_sphere_diameter"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">median_width</span>, <span class="va">squeezed_length_to_diameter</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">median_width</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'file'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 33 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   file [33]</span></span></span>
<span><span class="co">#&gt;    file      ac_field median_width corresponding_sphere_diameter</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Signal_4  FALSE            55.1                          34.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Signal_3  FALSE            60.4                          36.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Signal_2  FALSE            62.8                          36.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Signal_1  FALSE            65.6                          37.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Signal_0  FALSE            67.2                          37.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Signal_24 FALSE            68.3                          37.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Signal_6  FALSE            70.1                          38.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Signal_26 FALSE            70.5                          38.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Signal_21 FALSE            70.6                          38.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Signal_20 FALSE            71.8                          38.5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 23 more rows</span></span></span></code></pre></div>
<p>Interesting: After recording signals 0-4, I had to re-adjust the
laser focus due to chip movement. These recordings seem to cluster apart
from the other measurements. Also: This measurement approach becomes
inaccurate as the peak widths approach the resolution limit (see
<code>Signal33</code>).</p>
<p>Reasons for droplets appearing larger then actual when mesured like
this:</p>
<ul>
<li>laser spot is not an ideal point but has spatial extent, therefore
the PMTs receive a signal also, when the droplet is only partially
there</li>
<li>peak widths are measured from the beginning of the rising edge until
the end of the falling edge</li>
</ul>
</div>
<div class="section level3">
<h3 id="file-electric-field-state-level">(file, electric field state)-level<a class="anchor" aria-label="anchor" href="#file-electric-field-state-level"></a>
</h3>
<p>Summarize by groups:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grnSummary</span> <span class="op">&lt;-</span> <span class="va">grn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">ac_field</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"width_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"width_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"width_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"voltage_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">voltage</span><span class="op">)</span>,</span>
<span>                   <span class="st">"voltage_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">voltage</span><span class="op">)</span>,</span>
<span>                   <span class="st">"voltage_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">voltage</span><span class="op">)</span>,</span>
<span>                   <span class="st">"area_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,</span>
<span>                   <span class="st">"area_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,</span>
<span>                   <span class="st">"area_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,</span>
<span>                   <span class="st">"spacing_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spacing</span><span class="op">)</span>,</span>
<span>                   <span class="st">"spacing_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">spacing</span><span class="op">)</span>,</span>
<span>                   <span class="st">"spacing_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">spacing</span><span class="op">)</span>,</span>
<span>                   <span class="st">"frequency"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">t_max</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">t_max</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   <span class="st">"injected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">injected</span><span class="op">)</span>,</span>
<span>                   <span class="st">"n_droplets"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"velocity"</span> <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">q_emulsion</span><span class="op">+</span><span class="va">q_oil</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e9</span><span class="op">/</span><span class="fl">3600</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">20</span><span class="op">*</span><span class="fl">30</span><span class="op">)</span><span class="op">*</span><span class="fl">1e-6</span><span class="op">)</span> <span class="co"># m/s</span></span>
<span><span class="va">redSummary</span> <span class="op">&lt;-</span> <span class="va">red</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">ac_field</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"width_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"width_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"width_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"voltage_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">voltage</span><span class="op">)</span>,</span>
<span>                   <span class="st">"voltage_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">voltage</span><span class="op">)</span>,</span>
<span>                   <span class="st">"voltage_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">voltage</span><span class="op">)</span>,</span>
<span>                   <span class="st">"area_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,</span>
<span>                   <span class="st">"area_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,</span>
<span>                   <span class="st">"area_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,</span>
<span>                   <span class="st">"spacing_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">spacing</span><span class="op">)</span>,</span>
<span>                   <span class="st">"spacing_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">spacing</span><span class="op">)</span>,</span>
<span>                   <span class="st">"spacing_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">spacing</span><span class="op">)</span>,</span>
<span>                   <span class="st">"frequency"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">t_max</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">t_max</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   <span class="st">"is_false_droplet"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">is_false_drop</span><span class="op">)</span>,</span>
<span>                    <span class="st">"n_droplets"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"velocity"</span> <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">q_emulsion</span><span class="op">+</span><span class="va">q_oil</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e9</span><span class="op">/</span><span class="fl">3600</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">20</span><span class="op">*</span><span class="fl">30</span><span class="op">)</span><span class="op">*</span><span class="fl">1e-6</span><span class="op">)</span> <span class="co"># m/s</span></span></code></pre></div>
<p>Plot droplet frequency (as derived from the number of droplets
detected in the signal) vs. emulsion flow rate.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grnSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">q_emulsion</span>, y <span class="op">=</span> <span class="va">frequency</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span><span class="op">~</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>As expected, it can be seen that the droplet frequency depends
linearly on the emulsion flow rate. Therefore, I can use it as a second
axis when plotting against emulsion flow rate.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get linear regression</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">frequency</span> <span class="op">~</span> <span class="va">q_emulsion</span>, <span class="va">grnSummary</span><span class="op">)</span></span>
<span><span class="va">m</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = frequency ~ q_emulsion, data = grnSummary)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; (Intercept)   q_emulsion  </span></span>
<span><span class="co">#&gt;       21.72        12.05</span></span></code></pre></div>
<p>I find: frequency [Hz] = q_emulsion [µl/h] * 12.05 + 21.72. I neglect
the offset.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grnSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"width_um"</span> <span class="op">=</span> <span class="va">width_mean</span> <span class="op">*</span> <span class="va">velocity</span> <span class="op">*</span> <span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">q_emulsion</span>, <span class="va">q_oil</span>, <span class="va">p_water</span>, <span class="va">ac_field</span>, <span class="va">width_mean</span>, <span class="va">width_um</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"width_um"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">width_um</span>, <span class="va">squeezed_length_to_diameter</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 66 × 7</span></span></span>
<span><span class="co">#&gt;    file      q_emulsion q_oil p_water ac_field width_mean width_um</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Signal_0          25   150     125 FALSE      0.000<span style="text-decoration: underline;">839</span>     37.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Signal_0          25   150     125 TRUE       0.001<span style="text-decoration: underline;">20</span>      43.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Signal_1          25   150     115 FALSE      0.000<span style="text-decoration: underline;">830</span>     37.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Signal_1          25   150     115 TRUE       0.001<span style="text-decoration: underline;">12</span>      42.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Signal_10         50   300     150 FALSE      0.000<span style="text-decoration: underline;">483</span>     39.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Signal_10         50   300     150 TRUE       0.000<span style="text-decoration: underline;">612</span>     43.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Signal_11         50   300     160 FALSE      0.000<span style="text-decoration: underline;">484</span>     39.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Signal_11         50   300     160 TRUE       0.000<span style="text-decoration: underline;">601</span>     43.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Signal_12         50   300     170 FALSE      0.000<span style="text-decoration: underline;">472</span>     39.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Signal_12         50   300     170 TRUE       0.000<span style="text-decoration: underline;">607</span>     43.3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 56 more rows</span></span></span></code></pre></div>
<p>Next, I can determine the mean or median droplet diameter in the
non-injected populations (i.e. AC field off) and use it to measure the
volume increase, i.e. the injected volume. I do this on the droplet
population level, and not for individual droplets.</p>
<p>Plot Q_emulsion (~droplet frequency) vs. p_injection</p>
<ul>
<li>relate peak width to droplet dimensions by measuring droplet sizes
in high-speed video of uninjected droplets.</li>
</ul>
<p>Percentage of false droplets</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">redSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">is_false_droplet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">ac_field</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, position <span class="op">=</span> <span class="st">"identity"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage of false droplets"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Count"</span>, fill <span class="op">=</span> <span class="st">"Electric field on"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>Percentage of injected droplets:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grnSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">injected</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">ac_field</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, position <span class="op">=</span> <span class="st">"identity"</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Percentage of injected droplets"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Count"</span>, fill <span class="op">=</span> <span class="st">"Electric field on"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grnSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># filter(q_emulsion != 300) %&gt;% </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">velocity</span>, y <span class="op">=</span> <span class="va">p_water</span>, color <span class="op">=</span> <span class="va">injected</span>, shape <span class="op">=</span> <span class="va">ac_field</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge2</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># scale_color_gradientn(colours = pal) + </span></span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="single-file-level-1">Single-file level<a class="anchor" aria-label="anchor" href="#single-file-level-1"></a>
</h3>
<p>Consolidate electric field and channel into single rows:</p>
<ul>
<li>false_drops = percentage of false drops when field is on</li>
<li>false_injections = percentage of injected drops when field is
off</li>
<li>leakage = percentage of false drops when field is off</li>
<li>delta_width = median width field on minus field off</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract the base information from grnSummary</span></span>
<span><span class="va">drops</span> <span class="op">&lt;-</span> <span class="va">grnSummary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">q_oil</span>, <span class="va">q_emulsion</span>, <span class="va">p_water</span>, <span class="va">velocity</span>, <span class="va">frequency</span>, <span class="va">ac_v_pp</span>, <span class="va">ac_frequency</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    </span>
<span><span class="co"># get information about INJECTED droplets, i.e. channel == green and injected &gt; 0 (and probably field == off for most cases)</span></span>
<span><span class="va">grn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">injected</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"width_green_injected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"voltage_green_injected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">voltage</span><span class="op">)</span>,</span>
<span>                   <span class="st">"area_green_injected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,</span>
<span>                   .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span></span>
<span><span class="co"># get information about NON-injected droplets</span></span>
<span><span class="va">grn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">injected</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"width_green_noninjected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"voltage_green_noninjected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">voltage</span><span class="op">)</span>,</span>
<span>                   <span class="st">"area_green_noninjected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>,</span>
<span>                   .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    </span>
<span><span class="co"># get information about green drops when field is on</span></span>
<span><span class="va">grn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"n_droplets_on"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   <span class="st">"missed_injections"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">injected</span><span class="op">)</span> <span class="op">/</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="co"># missed injection = field on, but not injected</span></span>
<span>  by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    </span>
<span><span class="co"># get information about green drops when field is off</span></span>
<span><span class="va">grn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"n_droplets_off"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># number of green peaks when field is off</span></span>
<span>                   <span class="st">"false_injections"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">injected</span><span class="op">)</span> <span class="op">/</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="co"># false injections = field off, still injected</span></span>
<span>  by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span></span>
<span>    </span>
<span><span class="co"># get information about red droplets</span></span>
<span><span class="va">red</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"n_false_droplets"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">is_false_drop</span><span class="op">)</span><span class="op">)</span>, <span class="co"># false droplets = number of de-novo red droplets</span></span>
<span>  by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    </span>
<span><span class="co"># droplet leakage and false injections</span></span>
<span><span class="va">red</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ac_field</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"n_leaked_droplets"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">is_false_drop</span><span class="op">)</span>, <span class="co"># leaked droplets = number of de-novo red droplets</span></span>
<span>                   <span class="st">"n_red_droplets_off"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                   <span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"file"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Derive some further metrics from these data:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drops</span> <span class="op">&lt;-</span> <span class="va">drops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># calculate percentage of false/leaked droplets</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"false_droplets"</span> <span class="op">=</span> <span class="va">n_false_droplets</span><span class="op">/</span><span class="va">n_droplets_on</span>,</span>
<span>                <span class="st">"leaked_droplets"</span> <span class="op">=</span> <span class="va">n_leaked_droplets</span><span class="op">/</span><span class="va">n_droplets_off</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># compare injected vs. non-injected droplets</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"delta_width"</span> <span class="op">=</span> <span class="va">width_green_injected</span> <span class="op">-</span> <span class="va">width_green_noninjected</span>,</span>
<span>                <span class="st">"delta_voltage"</span> <span class="op">=</span> <span class="va">voltage_green_injected</span> <span class="op">-</span> <span class="va">voltage_green_noninjected</span>,</span>
<span>                <span class="st">"delta_area"</span> <span class="op">=</span> <span class="va">area_green_injected</span> <span class="op">-</span> <span class="va">area_green_noninjected</span>,</span>
<span>                <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># convert signal widths into spatial widths</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"width_green_injected_um"</span> <span class="op">=</span> <span class="va">width_green_injected</span> <span class="op">*</span> <span class="va">velocity</span> <span class="op">*</span> <span class="fl">1e6</span>,</span>
<span>                <span class="st">"width_green_noninjected_um"</span> <span class="op">=</span> <span class="va">width_green_noninjected</span> <span class="op">*</span> <span class="va">velocity</span> <span class="op">*</span> <span class="fl">1e6</span>,</span>
<span>                <span class="st">"delta_width_um"</span> <span class="op">=</span> <span class="va">delta_width</span> <span class="op">*</span> <span class="va">velocity</span> <span class="op">*</span> <span class="fl">1e6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># convert spatial width into droplet diameter</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"diameter_injected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">width_green_injected_um</span>, <span class="va">squeezed_length_to_diameter</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                <span class="st">"diameter_noninjected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">width_green_noninjected_um</span>, <span class="va">squeezed_length_to_diameter</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># express injection pressure as ratio</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"p_injection_relative"</span> <span class="op">=</span> <span class="va">p_water</span><span class="op">/</span><span class="op">(</span><span class="va">q_emulsion</span> <span class="op">+</span> <span class="va">q_oil</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p_injection_relative</span>, y <span class="op">=</span> <span class="va">delta_width_um</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">q_emulsion</span> <span class="op">+</span> <span class="va">q_oil</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">pal</span>, trans <span class="op">=</span> <span class="st">"log"</span>,</span>
<span>                       breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">drops</span><span class="op">$</span><span class="va">q_emulsion</span> <span class="op">+</span> <span class="va">drops</span><span class="op">$</span><span class="va">q_oil</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"horizontal"</span>, title.position <span class="op">=</span> <span class="st">"top"</span>, byrow <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Relative injection pressure "</span><span class="op">*</span> <span class="va">p</span><span class="op">[</span><span class="st">"injection"</span><span class="op">]</span><span class="op">/</span><span class="va">Q</span><span class="op">[</span><span class="st">"total"</span><span class="op">]</span> <span class="op">*</span> <span class="st">" [mbar/µL/h]"</span><span class="op">)</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Delta width [µm]"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Total flowrate [µL/h]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"lel.pdf"</span>, width<span class="op">=</span><span class="fl">16.5</span><span class="op">*</span><span class="fl">2</span>, height <span class="op">=</span> <span class="fl">11.7</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">drops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">ac_v_pp</span>, <span class="op">-</span><span class="va">ac_frequency</span>, <span class="op">-</span><span class="va">n_droplets_on</span>, <span class="op">-</span><span class="va">n_droplets_off</span>, <span class="op">-</span><span class="va">n_false_droplets</span>, <span class="op">-</span><span class="va">n_leaked_droplets</span>, <span class="va">n_red_droplets_off</span>, <span class="op">-</span><span class="va">delta_width</span>, <span class="op">-</span><span class="va">width_green_injected</span>, <span class="op">-</span><span class="va">width_green_noninjected</span>, <span class="op">-</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-additional-imaging-data-to-correct-the-droplet-sizes-derived-from-pmt-signals-and-flow-rates">Use additional imaging data to correct the droplet sizes derived
from PMT signals and flow rates<a class="anchor" aria-label="anchor" href="#use-additional-imaging-data-to-correct-the-droplet-sizes-derived-from-pmt-signals-and-flow-rates"></a>
</h3>
<p>Read droplet sizes derived from image analysis and compare:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"data/fads/230126"</span>, pattern <span class="op">=</span> <span class="st">"_kymograph_droplets.txt$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">kymographDrops</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="va">files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">kymographDrops</span> <span class="op">&lt;-</span> <span class="va">kymographDrops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>      <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span><span class="va">f</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"file"</span> <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, <span class="st">"\\d{8}_\\d{6}"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>        <span class="co"># normalize intensity by droplet width</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"intensity"</span> <span class="op">=</span> <span class="va">intensity</span><span class="op">/</span><span class="va">width</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># add metadata</span></span>
<span><span class="va">kymographDrops</span> <span class="op">&lt;-</span> <span class="va">kymographDrops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"video"</span> <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span><span class="st">"data/fads/230126/metadata.txt"</span>, show_col_types <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"video"</span></span>
<span>  <span class="op">)</span></span>
<span> <span class="va">kymographDrops</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,769 × 14</span></span></span>
<span><span class="co">#&gt;    slice  left right width intensity video   file  q_oil p_water q_emu…¹ ac_v_pp</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     5  16.5  58.3  41.7      325. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    13  41.7  82.2  40.4      308. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    32  16.1  57.8  41.7      326. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    39  41.7  82.2  40.4      321. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    46  16.5  57.8  41.3      320. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    53  41.7  82.2  40.4      316. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    59  15.2  57.0  41.7      329. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    67  41.7  82.2  40.4      311. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    87  14.3  55.2  40.9      322. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    94  41.7  82.2  40.4      312. 202301… Sign…   150     125      25       5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 1,759 more rows, 3 more variables: ac_frequency &lt;dbl&gt;, t_off &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   laser_focus &lt;dbl&gt;, and abbreviated variable name ¹​q_emulsion</span></span></span></code></pre></div>
<p>Summarize these into important statistics</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diametersKymo</span> <span class="op">&lt;-</span> <span class="va">kymographDrops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">video</span>, <span class="va">laser_focus</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"diameter_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"diameter_median"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"diameter_sd"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span>,</span>
<span>                   <span class="st">"n_droplets"</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="va">widthNotInjected</span> <span class="op">&lt;-</span> <span class="va">kymographDrops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">video</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"diameter_mean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">diameter_mean</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Correlate the two droplet diameter measurements. I am translating the
measured droplet diameter into the corresponding equivalent droplet
length, when the droplet is squeezed in the channel (since that’s where
the laser measures its length).</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diametersBoth</span> <span class="op">&lt;-</span> <span class="va">drops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">width_green_injected_um</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">diametersKymo</span>, by <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">diameter_median</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># convert measured diameter in equivalent squeezed droplet length</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"equivalent_squeezed_length"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">diameter_median</span>, <span class="va">diameter_to_squeezed_length</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">diametersBoth</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">equivalent_squeezed_length</span>, y <span class="op">=</span> <span class="va">width_green_injected_um</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">laser_focus</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">n_droplets</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/theme_pretty_thesis.html">theme_pretty_thesis</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-32-1.png" width="700">
There seems to be a constant offset between droplet sizes measured from
images, and those derived from the PMT signals. After the first five
measurements, I had to adjust the chip position slightly, and therefore
the laser focus was slightly different in subsequent acquisitions.
Therefore, I will use two different width-correction values for the two
groups.</p>
<p>The average offset is:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diametersBoth</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">laser_focus</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="st">"y_intercept"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">width_green_injected_um</span> <span class="op">-</span> <span class="fl">1</span><span class="op">*</span> <span class="va">equivalent_squeezed_length</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   laser_focus y_intercept</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>           1        8.68</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>           2       26.2</span></span></code></pre></div>
<p>That means, the signal peaks measured by the PMT tubes and as
detected by the MATLAB code are on average 26.18 (or 8.68 in the first
laser focus spot configuration) µm too wide. I will therefore subtract
this value from the signal length, before computing the corresponding
droplet volume.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dropsCorrected</span> <span class="op">&lt;-</span> <span class="va">drops</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="va">width_green_injected</span>, <span class="op">-</span><span class="va">width_green_noninjected</span>, <span class="op">-</span><span class="va">delta_width</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">file</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Signal_0"</span>, <span class="st">"Signal_1"</span>, <span class="st">"Signal_2"</span>, <span class="st">"Signal_3"</span>, <span class="st">"Signal_4"</span><span class="op">)</span> <span class="op">~</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">width_green_injected_um</span>, <span class="va">width_green_noninjected_um</span><span class="op">)</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op">-</span><span class="fl">8.68</span><span class="op">)</span>,</span>
<span>                                 .default <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">width_green_injected_um</span>, <span class="va">width_green_noninjected_um</span><span class="op">)</span>, <span class="op">~</span> <span class="va">.x</span> <span class="op">-</span><span class="fl">26.19</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co"># convert squeezed width into sphere diameter</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">"diameter_injected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">width_green_injected_um</span>, <span class="va">squeezed_length_to_diameter</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>                <span class="st">"diameter_noninjected"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">width_green_noninjected_um</span>, <span class="va">squeezed_length_to_diameter</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Actually, there is a second factor that need to be corrected for:
When a droplet is being injected, the total flow rate in the channel
increases, and therefore also the fluid velocity. This was not accounted
for when calculating droplet velocities, and deriving spatial droplet
sizes from that.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dropsCorrected</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p_water</span>, y <span class="op">=</span> <span class="va">diameter_noninjected</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="fads_picoinjector_characterization_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<p>Since theoretically pressure contributes linearly to flowrate, which,
in turn is directly proportional to the fluid velocity, I correct for
the additional flow rate component by scaling the width accordingly</p>
<p>Investigate the difference in signal width between injected and
non-injected droplets:</p>
<p>For which parameter combinations picoinjection was possible, in
general?</p>
<!-- ```{r} -->
<!-- grnSummary -->
<!-- ``` -->
<!-- Combine red and green summaries: -->
<!-- ```{r} -->
<!-- grnFinal <- grnSummary %>%  -->
<!--   group_by(file) %>%  -->
<!--   summarise() -->
<!-- ``` -->
<!-- ```{r} -->
<!-- grnSummary %>%  -->
<!--   ggplot(aes(x = q_emulsion, y = p_water)) +  -->
<!--   geom_point()  + -->
<!--   scale_x_continuous(sec.axis = sec_axis(~ . *m$coefficients[2], name = "Droplet frequency [Hz]")) +  -->
<!--   theme_pretty() -->
<!-- ``` -->
</div>
</div>
<div class="section level2">
<h2 id="other-stuff">Other stuff<a class="anchor" aria-label="anchor" href="#other-stuff"></a>
</h2>
<p>Filter outlier widths</p>
<!-- ```{r} -->
<!-- g <- grn %>%  -->
<!--   group_by(file, ac_field) %>%  -->
<!--   filter(width > quantile(width, 0.05) & width < quantile(width, 0.95)) %>%  -->
<!--   ungroup() %>%  -->
<!--   filter(file == "Signal_2" & ac_field == T) %>%  -->
<!--   ggplot(aes(x = width)) +  -->
<!--   geom_density() -->
<!-- g -->
<!-- ``` -->
<!-- ```{r} -->
<!-- c25 <- c( -->
<!--   "dodgerblue2", "#E31A1C", # red -->
<!--   "green4", -->
<!--   "#6A3D9A", # purple -->
<!--   "#FF7F00", # orange -->
<!--   "black", "gold1", -->
<!--   "skyblue2", "#FB9A99", # lt pink -->
<!--   "palegreen2", -->
<!--   "#CAB2D6", # lt purple -->
<!--   "#FDBF6F", # lt orange -->
<!--   "gray70", "khaki2", -->
<!--   "maroon", "orchid1", "deeppink1", "blue1", "steelblue4", -->
<!--   "darkturquoise", "green1", "yellow4", "yellow3", -->
<!--   "darkorange4", "brown" -->
<!-- ) -->
<!-- getPalette <- colorRampPalette(c25) -->
<!-- ``` -->
<div class="section level3">
<h3 id="evaluate-switching-performance">Evaluate switching performance<a class="anchor" aria-label="anchor" href="#evaluate-switching-performance"></a>
</h3>
<p>Load RED signals</p>
<p>Summarize them for every file and field state and calculate
percentage of false droplets.</p>
</div>
</div>
<div class="section level2">
<h2 id="final-plots">Final plots<a class="anchor" aria-label="anchor" href="#final-plots"></a>
</h2>
<p>What do I wanna communicate with my plots:</p>
<ul>
<li>what injected volumes can be expected</li>
<li>Injected volume consistency</li>
<li>switchability</li>
<li>flexibility in the injected volume</li>
<li>how to operate the picoinjector, which operating regimes are there?
(max throughput, max percentage of injected droplets, min percentage of
false droplets, high consistency of injected volume)</li>
</ul>
<p>Plot the distribution of <code>width</code> values, but only for
times were the AC field was switched on, i.e. droplets were being
picoinjected and therefore their width is supposed to increase with
increasing injection pressure.</p>
<!-- ```{r, fig.width=6, fig.height=10} -->
<!-- grn %>% -->
<!--   group_by(file, ac_field) %>% -->
<!--   filter(width > quantile(width, 0.05) & width < quantile(width, 0.95)) %>% # remove outliers -->
<!--   dplyr::filter(ac_field = TRUE) %>% -->
<!--   dplyr::mutate("q" = q_oil + q_emulsion) %>% -->
<!--   ggplot(aes(x = width, fill = factor(p_water))) + -->
<!--   geom_histogram(bins = 30, position = "identity", alpha = 0.2) + -->
<!--   scale_fill_viridis_d() + -->
<!--   facet_wrap(~ factor(q), ncol = 1, scales = "free") + -->
<!--   theme_pretty_thesis() -->
<!-- ``` -->
<p>Width distribution for every signal:</p>
<!-- ```{r, fig.width=10, fig.height=15} -->
<!-- grn %>%  -->
<!--   ggplot(aes(x = width, fill = ac_field)) +  -->
<!--   geom_histogram(position = "identity", alpha = 0.2) +  -->
<!--   facet_wrap(~ file, scales = "free", ncol = 4) +  -->
<!--   theme_pretty_thesis() -->
<!-- ``` -->
</div>
<div class="section level2">
<h2 id="todo">TODO<a class="anchor" aria-label="anchor" href="#todo"></a>
</h2>
<p>If I normalize the width by the droplet velocity, I should be able to
superimpose the width distributions of all populations were the field
was switched off, and find them at the same location.</p>
<p>Argument (if the signal-width-derived droplet size deviates more
)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Fynn Withake.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
